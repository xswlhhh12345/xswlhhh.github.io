<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 7.1.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.ico">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.ico">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">
  <link rel="stylesheet" href="/lib/pace/pace-theme-minimal.min.css">
  <script src="/lib/pace/pace.min.js"></script>

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":false,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"manual","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content=":::info题目：文本查询程序  实现一个文本查询程序。  需求  1. 使用 C++ 完成代码，确保程序可由 C++ 编译器（如g++）编译。  2. 采用面向对象的思想编写程序，以使程序更为优雅可靠。程序应该尽可能符合正常使用习  惯。  3. 程序实现两个功能，一个是文件格式化功能，另一个是文本查询功能，打开程序时可以选  择功能，类似如下  选择需要的功能：  1. 文件格式化  2.">
<meta property="og:type" content="article">
<meta property="og:title" content="C++第三次小项目——文本查询程序">
<meta property="og:url" content="http://example.com/2024/11/08/C-%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%B0%8F%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E7%A8%8B%E5%BA%8F/index.html">
<meta property="og:site_name" content="xswlhhh的黄金屋">
<meta property="og:description" content=":::info题目：文本查询程序  实现一个文本查询程序。  需求  1. 使用 C++ 完成代码，确保程序可由 C++ 编译器（如g++）编译。  2. 采用面向对象的思想编写程序，以使程序更为优雅可靠。程序应该尽可能符合正常使用习  惯。  3. 程序实现两个功能，一个是文件格式化功能，另一个是文本查询功能，打开程序时可以选  择功能，类似如下  选择需要的功能：  1. 文件格式化  2.">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704529617060-c79e7bd4-da7a-4d43-bf1f-115b0b6a9eec.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704532241776-c17d27f3-7fed-4b78-92fd-53114aac86bc.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704532171956-431bee23-b70c-45a8-a252-a03f34a9141c.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523984530-c577a032-a2fd-4e93-b06d-5651ebcdb138.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523808550-09f668af-a43d-4bb2-a0d5-2118441545ce.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523766560-fd64c2bb-e889-4f77-9423-6c76ff93fe72.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523843712-98b9fd63-9d0f-4ec7-9376-6f072db8fd50.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540735494-f2cedcc8-0f5a-4de1-876b-55eb3a88d8ae.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704541429865-d1f0af06-56a1-4acd-aee2-b382fbf76e76.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540889279-4f1ec330-28f5-402e-b8d2-ae3716d72008.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540714628-b25c6efc-db46-4184-94bb-ab1cb59a1d3e.png">
<meta property="og:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704542200925-6309bb02-72a2-430d-9780-4e2f5de6cd5d.png">
<meta property="article:published_time" content="2024-11-08T07:41:33.000Z">
<meta property="article:modified_time" content="2024-11-08T07:49:35.696Z">
<meta property="article:author" content="xswlhhh">
<meta property="article:tag" content="C++">
<meta property="article:tag" content="作业">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704529617060-c79e7bd4-da7a-4d43-bf1f-115b0b6a9eec.png">

<link rel="canonical" href="http://example.com/2024/11/08/C-%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%B0%8F%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E7%A8%8B%E5%BA%8F/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>C++第三次小项目——文本查询程序 | xswlhhh的黄金屋</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">xswlhhh的黄金屋</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/home" rel="section"><i class="home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-about">

    <a href="/about/" rel="section"><i class="user fa-fw"></i>关于</a>

  </li>
        <li class="menu-item menu-item-resources">

    <a href="/resources/" rel="section"><i class="download fa-fw"></i>资源</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/2024/11/08/C-%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%B0%8F%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E7%A8%8B%E5%BA%8F/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/myavatar.jpg">
      <meta itemprop="name" content="xswlhhh">
      <meta itemprop="description" content="用最少的时间做无关的事，用最多的时间做紧要的事">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="xswlhhh的黄金屋">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          C++第三次小项目——文本查询程序
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2024-11-08 15:41:33 / 修改时间：15:49:35" itemprop="dateCreated datePublished" datetime="2024-11-08T15:41:33+08:00">2024-11-08</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%A4%A7%E5%AD%A6%E8%AF%BE%E7%A8%8B/" itemprop="url" rel="index"><span itemprop="name">大学课程</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>
            <span class="post-meta-item" title="本文字数">
              <span class="post-meta-item-icon">
                <i class="far fa-file-word"></i>
              </span>
              <span>45k</span>
            </span>
            <span class="post-meta-item" title="阅读时长">
              <span class="post-meta-item-icon">
                <i class="far fa-clock"></i>
              </span>
              <span>41 分钟</span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <p>:::info<br><strong><font style="color:rgb(0,0,0);">题目：文本查询程序 </font></strong></p>
<p><font style="color:rgb(0,0,0);">实现一个文本查询程序。 </font></p>
<p><strong><font style="color:rgb(0,0,0);">需求 </font></strong></p>
<p><font style="color:rgb(0,0,0);">1. 使用 C++ 完成代码，确保程序可由 C++ 编译器（如g++）编译。 </font></p>
<p><font style="color:rgb(0,0,0);">2. </font><font style="color:rgb(0,0,0);">采用面向对象的思想编写程序，以使程序更为优雅可靠。程序应该尽可能符合正常使用习 </font></p>
<p><font style="color:rgb(0,0,0);">惯。 </font></p>
<p><font style="color:rgb(0,0,0);">3. </font><font style="color:rgb(0,0,0);">程序实现两个功能，一个是</font><strong><font style="color:rgb(0,0,0);">文件格式化</font></strong><font style="color:rgb(0,0,0);">功能，另一个是</font><strong><font style="color:rgb(0,0,0);">文本查询</font></strong><font style="color:rgb(0,0,0);">功能，打开程序时可以选 </font></p>
<p><font style="color:rgb(0,0,0);">择功能，类似如下 </font></p>
<p><font style="color:rgb(0,0,0);">选择需要的功能： </font></p>
<p><font style="color:rgb(0,0,0);">1. </font><font style="color:rgb(0,0,0);">文件格式化 </font></p>
<p><font style="color:rgb(0,0,0);">2. </font><font style="color:rgb(0,0,0);">文本查询 </font></p>
<p><font style="color:rgb(0,0,0);">3. </font><font style="color:rgb(0,0,0);">退出 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">4. </font><font style="color:rgb(0,0,0);">进入文件格式化功能，程序会根据用户后续输入的文件位置（绝对地址或相对地址）和文 </font></p>
<p><font style="color:rgb(0,0,0);">件名读取文件，并由用户指定每行最大字符数</font><font style="color:rgb(0,0,0);"> n</font><font style="color:rgb(0,0,0);">，处理文件，使得文件在行数到达</font><font style="color:rgb(0,0,0);"> n </font><font style="color:rgb(0,0,0);">时进 </font></p>
<p><font style="color:rgb(0,0,0);">行换行（若为英文，需要切断单词时，提前换行，避免单词被切断，且需使得标点符号不 </font></p>
<p><font style="color:rgb(0,0,0);">在行首），并由用户指定保存新文件的位置与新文件名，若位置与新文件名已存在，由用 </font></p>
<p><font style="color:rgb(0,0,0);">户确认是否替换（原有文件内容不可改变，除非新文件与原文件在相同位置且有相同文件 </font></p>
<p><font style="color:rgb(0,0,0);">名，并被确认替换）。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">5. </font><font style="color:rgb(0,0,0);">文本查询允许用户指定一个文件（给定文件位置与文件名），并在其中查询单词，查询结 </font></p>
<p><font style="color:rgb(0,0,0);">果是单词在文件中出现的次数及其所在行的列表。如果一个单词在一行中出现多次，此行 </font></p>
<p><font style="color:rgb(0,0,0);">只列出一次。行会按照升序输出，即第</font><font style="color:rgb(0,0,0);">7</font><font style="color:rgb(0,0,0);">行会在第</font><font style="color:rgb(0,0,0);">9</font><font style="color:rgb(0,0,0);">行之前显示，以此类推。如果查询不 </font></p>
<p><font style="color:rgb(0,0,0);">到，则不输出。</font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">6. </font><font style="color:rgb(0,0,0);">文本查询功能可以通过交互式的方式保存用户输入的</font><strong><font style="color:rgb(0,0,0);">字符串</font></strong><font style="color:rgb(0,0,0);">（与项目二一样，忽略输入时 </font></p>
<p><font style="color:rgb(0,0,0);">的各种空格），并可以支持逻辑查询操作（各种逻辑运算）。</font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">10. </font><font style="color:rgb(0,0,0);">尝试支持批量读取文件，并进行针对多文件的查询。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">11. </font><font style="color:rgb(0,0,0);">尝试支持将查询结果输出到新文件中，而非打印，如 </font></p>
<p><font style="color:rgb(0,0,0);">&gt;&gt;&gt; a | b &gt;&gt; .&#x2F;result.txt </font><em><font style="color:rgb(0,128,0);">#</font></em><font style="color:rgb(0,128,0);">将结果输出到当前目录的文件</font><em><font style="color:rgb(0,128,0);">result.txt</font></em><font style="color:rgb(0,128,0);">中 </font></p>
<p><font style="color:rgb(0,128,0);"></font></p>
<p><font style="color:rgb(0,0,0);">12. </font><font style="color:rgb(0,0,0);">可尝试多种方式对代码进行优化，包括执行速度、功能等；可以尝试完善错误提示，让错 </font></p>
<p><font style="color:rgb(0,0,0);">误提示更加明确；可内嵌帮助文档，通过特定指令能够输出对应帮助文档。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">13. </font><font style="color:rgb(0,0,0);">可以使用</font><font style="color:rgb(0,0,0);"> STL </font><font style="color:rgb(0,0,0);">等库进行实现，但不能直接采用功能非常类似的他人的程序。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">14. </font><font style="color:rgb(0,0,0);">项目报告需对需求进行分析，描述实现方案与项目特色。报告应包含核心代码并进行解 </font></p>
<p><font style="color:rgb(0,0,0);">释。如果编译运行复杂，请提供编译运行代码的说明。提供运行结果的展示（如截图）， </font></p>
<p><font style="color:rgb(0,0,0);">并尽量给出性能展示与分析。最后给出总结。同时，鼓励写上实现代码时遇到的困难以及 </font></p>
<p><font style="color:rgb(0,0,0);">相应的解决思路</font><font style="color:rgb(0,0,0);">&#x2F;</font><font style="color:rgb(0,0,0);">方案。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">15. </font><font style="color:rgb(0,0,0);">允许适当发挥，使得程序功能更加丰富。 </font></p>
<p><font style="color:rgb(0,0,0);"></font></p>
<p><font style="color:rgb(0,0,0);">16. 提示：可以参考书籍《C++ Primer 第五版》12.3节与15.9节内容。 </font></p>
<p>:::</p>
<h1 id="ye4Hl"><font style="color:rgb(0,0,0);">实验报告解析</font></h1>
<h2 id="Pz6p1">写在前面</h2>

<p>得到的一些小细节启发</p>
<p>1.智能指针的初始化</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//这样子是在堆上申请内存，同时也能调用set&lt;int&gt;的构造函数</span></span><br><span class="line">shared_ptr&lt;set&lt;<span class="type">int</span>&gt;&gt; ptr=make_shared&lt;set&lt;<span class="type">int</span>&gt;&gt;()</span><br><span class="line"><span class="comment">//如果是new的方法，会导致内存非法访问，大概是因为make_shared控制了它的作用域的问题</span></span><br></pre></td></tr></table></figure>

<p>2.ofstrem.wirte()方法适用于写二进制数据，而不是文本。</p>
<h2 id="Kyyb2">开始解析</h2>

<p>:::info<br><font style="color:rgb(0,0,0);">1. 使用 C++ 完成代码，确保程序可由 C++ 编译器（如g++）编译。 </font></p>
<p><font style="color:rgb(0,0,0);">2. </font><font style="color:rgb(0,0,0);">采用面向对象的思想编写程序，以使程序更为优雅可靠。程序应该尽可能符合正常使用习 </font></p>
<p><font style="color:rgb(0,0,0);">惯。 </font></p>
<p>:::</p>
<p><font style="color:rgb(0,0,0);">不需要装多余的库，我们需要用到的基本上STL都有，直接用STL和算法库就行了。因此不需要加多余的编译选项，能够通过编译就行。</font></p>
<p><font style="color:rgb(0,0,0);">本项目是为了实现一个文本查询的功能，需要读写文件操作，需要有文章，打印行号等，为了符合面向对象的思想，同时参考第16点提示去看了一下C++ Primer第五版的对应内容，设计了如下的类，为了适应本程序，所以类里面的对象和方法有一点小小改动。</font></p>
<p><font style="color:rgb(0,0,0);">接下来我们展示我们用到的类</font></p>
<p><font style="color:rgb(0,0,0);">首先是QueryResult和TextQuery类，第一个类设计的目的是为了保存查询后的结果，第二个TextQuery类设计的目的是为了打开文件进行读取操作，然后对文章的内容进行解析。</font></p>
<p><font style="color:rgb(0,0,0);">下面介绍这两个类的功能与作用，以及设计的思想：</font></p>
<h3 id="iBy3I"><font style="color:rgb(0,0,0);">基于面向对象的所用类介绍</font></h3>
<h4 id="R3Ror"><font style="color:rgb(0,0,0);">对于TextQuery</font></h4>

<p><font style="color:rgb(0,0,0);">首先对于一篇文章的获取首先要打开文件，程序要求我们查询单词，返回对应的行号和内容。</font></p>
<p><font style="color:rgb(0,0,0);">那么我们首先就要有一个容器存储行号，最好的是set<unsigned>，因为它无序性，不重复。</font></p>
<p><font style="color:rgb(0,0,0);">随后我们输入单词，要返回行号，明显是键值对的结构，这里采用map&lt;string,set<unsigned>&gt;，让它做自己排序</font></p>
<p><font style="color:rgb(0,0,0);">然后要打印其对应行号的内容，这说明我们要存储文章，采用vector<string>存储文章，每个元素就是它的句子。</font></p>
<p>对于第一个方法，我们在构造函数的时候，就应该把这两个成员处理好，我们读入文章首先要一个文件流，所以传参进来的是一个读入的文件流ifstream。然后一行一行读取进行分割就是。</p>
<p>第二个方法，我们query方法查找要返回一个结果类，结果QueryResult类的代码放在下面一个小标题，我们需要一个string来查询，根据查询的结果（有则返回对应的值，无则返回空集合）采用QueryResult的构造函数返回。</p>
<p><strong>那么问题来了，为了让QueryResult打印出对应的内容，QueryResult也需要传入一个存储文章的容器，这样直接拷贝的话就很麻烦，以及浪费空间，如果直接用TextQuery的file可能还有作用域非法访问的问题，所以我们把TextQuery的成员全部设置成共享指针，让shared_ptr来管理</strong>，因此才如代码所示。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">TextQuery</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">shared_ptr&lt;vector&lt;string&gt;&gt; file;<span class="comment">//存储文章的向量只能得指针</span></span><br><span class="line">map&lt;string,shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;&gt; wordmap;<span class="comment">//用unsigned存储行号</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">//初始化需要一个文件流。</span></span><br><span class="line"><span class="built_in">TextQuery</span>(ifstream&amp; is):<span class="built_in">file</span>(<span class="keyword">new</span> vector&lt;string&gt;)<span class="comment">//对文件流的单词句子进行解读</span></span><br><span class="line">&#123;</span><br><span class="line">    string text;</span><br><span class="line">    <span class="keyword">while</span>(<span class="built_in">getline</span>(is,text))<span class="comment">//获取每一行</span></span><br><span class="line">        &#123;<span class="comment">//file是一个vector对象</span></span><br><span class="line">            file-&gt;<span class="built_in">push_back</span>(text);</span><br><span class="line">            <span class="type">int</span> n=file-&gt;<span class="built_in">size</span>()<span class="number">-1</span>;<span class="comment">//也就是行号？下标？</span></span><br><span class="line">            <span class="function">istringstream <span class="title">line</span><span class="params">(text)</span></span>;</span><br><span class="line">            string word;</span><br><span class="line">            <span class="keyword">while</span>(line &gt;&gt; word)<span class="comment">//用string这个流分解单词</span></span><br><span class="line">                &#123;<span class="comment">//匹配每一个单词</span></span><br><span class="line">                    shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; lines;<span class="comment">//map的值是一个(set对象的)智能指针</span></span><br><span class="line">                    <span class="keyword">if</span>(!wordmap.<span class="built_in">count</span>(word))&#123;<span class="comment">//如果不存在，说明是新单词，开辟一个set空间，并初始化</span></span><br><span class="line">                        lines = make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;();</span><br><span class="line">                        wordmap[word] = lines;</span><br><span class="line">                    &#125;</span><br><span class="line">                    wordmap[word]-&gt;<span class="built_in">insert</span>(n);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">QueryResult <span class="title">query</span><span class="params">(<span class="type">const</span> string&amp; inputword)</span><span class="type">const</span><span class="comment">//返回查找结果，查找结果是一个queryRE对象</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//如果未找到，就直接返回一个指向空的set的set共享指针</span></span><br><span class="line">    <span class="type">static</span> shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">nodata</span>(<span class="keyword">new</span> <span class="built_in">set</span>&lt;<span class="type">unsigned</span>&gt;());<span class="comment">//返回智能指针指向空set</span></span><br><span class="line">    <span class="keyword">auto</span> loc=wordmap.<span class="built_in">find</span>(inputword);</span><br><span class="line">    <span class="keyword">if</span>(loc == wordmap.<span class="built_in">end</span>())&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(inputword,nodata,file);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(inputword,loc-&gt;second,file);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h4 id="RQI0Z"><font style="color:rgb(0,0,0);">对于QueryResult</font></h4>

<p>对于返回的结果类，我们首先肯定保存有指向文章vector的共享指针，然后还要保存选出来的行号set的共享指针，同时保存需要查询的单词。</p>
<p>同理，该让共享指针管理的就让它管理。该类具有一些获取本成员的方法，以及打印的方法。</p>
<p>在以后得利用差集计算非集，所以也弄了个返回指向文章全部行号的集合的共享指针的方法</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QueryResult</span>&#123;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">string inputword;<span class="comment">//需要查询的单词</span></span><br><span class="line">shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; idx;<span class="comment">//出现的行号</span></span><br><span class="line">shared_ptr&lt;vector&lt;string&gt;&gt; file;<span class="comment">//查找的文件</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="built_in">QueryResult</span>(string s,shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; i,shared_ptr&lt;vector&lt;string&gt;&gt; f):<span class="built_in">inputword</span>(s),<span class="built_in">idx</span>(i),<span class="built_in">file</span>(f)&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;\&quot;&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;inputword&lt;&lt;<span class="string">&quot;\&quot;出现了&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;idx-&gt;<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot;次&quot;</span>&lt;&lt;endl;</span><br><span class="line">    <span class="comment">//打印出现的每一行</span></span><br><span class="line">    <span class="keyword">for</span>(<span class="keyword">auto</span> num:*(<span class="keyword">this</span>-&gt;idx))&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot; (line &quot;</span>&lt;&lt;num+<span class="number">1</span>&lt;&lt;<span class="string">&quot;) &quot;</span>;</span><br><span class="line">        cout&lt;&lt;*(<span class="keyword">this</span>-&gt;file-&gt;<span class="built_in">begin</span>()+num)&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">shared_ptr&lt;vector&lt;string&gt;&gt; <span class="built_in">getfile</span>()&#123;<span class="comment">//返回file的共享指针</span></span><br><span class="line">    <span class="keyword">return</span> file;</span><br><span class="line">&#125;</span><br><span class="line">shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">getset</span>()&#123;<span class="comment">//返回行号的共享指针</span></span><br><span class="line">    <span class="keyword">return</span> idx;</span><br><span class="line">&#125;</span><br><span class="line">shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">getfileset</span>()&#123;<span class="comment">//返回整体行号的共享指针</span></span><br><span class="line">    shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; fileset =make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;();;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;file-&gt;<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">        fileset-&gt;<span class="built_in">insert</span>(i);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> fileset;</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<p><font style="color:rgb(0,0,0);">到这里，已经可以实现查询一个单词的功能了</font></p>
<h4 id="eyY5A"><font style="color:rgb(0,0,0);">关于采用逻辑查询操作的类</font></h4>

<p>我们需要重载逻辑运算，逻辑运算单目是~，双目是|和&amp;，这就是它们的区别。</p>
<p>运算过程中，运算的操作数是什么类型的，运算后的结果又是什么类型？</p>
<p>虽然我们可以运算出一个集合，然后让两个集合进行逻辑运算，这样子可以实现eval计算的基本思路，但是如果我们还需要别方法呢，比如知道当前是在查询什么东西（如知道查询”~(a|b)”）</p>
<p>我们不妨设计一个类，参考书本设计了对应的类</p>
<p>我们按照对应的运算设计对应的类，如NotQuery<font style="color:rgb(63, 74, 84);">、</font>OrQuery<font style="color:rgb(63, 74, 84);">、</font>AndQuery，其中双目运算的类继承于BinaryQuery，然后再继承于QueryBase，NotQuery直接继承于QueryBase。<strong>然后就是各自对QueryBase的虚函数以及运算符进行重载</strong></p>
<p>我们让运算返回一个结果，这个结果如果是让共享指针去管理，那么就可以省很多问题，因此设计了Query，有一个成员是指向QueryBase类型的一个共享指针。</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QueryBase</span>&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Query</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">unsigned</span> idx;<span class="comment">//没用的成员</span></span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">QueryBase</span>()&#123;&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery&amp;)</span><span class="type">const</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;&#125;<span class="comment">//生成用于查询的rep文本</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WordQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Query</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">WordQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//构造函数，接收string</span></span><br><span class="line">    <span class="built_in">WordQuery</span>(<span class="type">const</span> string &amp;s):<span class="built_in">query_word</span>(s)&#123;&#125;</span><br><span class="line">    <span class="comment">//重载虚构函数</span></span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;t)</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.<span class="built_in">query</span>(query_word);<span class="comment">//wordquery返回的结果就是根据单词本身返回的QueryRE</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> query_word;</span><br><span class="line">    &#125;</span><br><span class="line">    string query_word;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Query</span>&#123;</span><br><span class="line">    <span class="comment">//对三个运算符友元</span></span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query&amp;);</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> |(<span class="type">const</span> Query&amp; ,<span class="type">const</span> Query &amp;);</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> &amp;(<span class="type">const</span> Query&amp; ,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//构造函数shared_ptr</span></span><br><span class="line">    <span class="comment">//传进来是 指向QueryBase类型的 共享指针</span></span><br><span class="line">    shared_ptr&lt;QueryBase&gt; q;<span class="comment">//指向基类的指针</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Query</span>(shared_ptr&lt;QueryBase&gt; query):<span class="built_in">q</span>(query)&#123;&#125;;</span><br><span class="line">    Query&amp; <span class="keyword">operator</span> =(<span class="type">const</span> Query&amp; que)&#123;</span><br><span class="line">        q=que.q;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Query</span>(<span class="type">const</span> string &amp;s)&#123;</span><br><span class="line">        <span class="function">shared_ptr&lt;WordQuery&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> WordQuery(s))</span></span>;</span><br><span class="line">        q=ptr;</span><br><span class="line">    &#125;<span class="comment">//传进来是string类型的 用来构建WordQuery,来创建Query的q成员</span></span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;t)</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q-&gt;<span class="built_in">eval</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span> <span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q-&gt;<span class="built_in">rep</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> ostream &amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;os,<span class="type">const</span> Query&amp; query)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> os &lt;&lt; query.<span class="built_in">rep</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">NotQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">NotQuery</span>(<span class="type">const</span> Query &amp;q):<span class="built_in">query</span>(q)&#123;&#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;~(&quot;</span>+query.<span class="built_in">rep</span>()+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp; text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> sml=query.<span class="built_in">eval</span>(text);</span><br><span class="line">        <span class="keyword">auto</span> smlset=sml.<span class="built_in">getset</span>();</span><br><span class="line">        <span class="keyword">auto</span> allset=sml.<span class="built_in">getfileset</span>();</span><br><span class="line">        set&lt;<span class="type">unsigned</span>&gt; resultset;</span><br><span class="line">        <span class="comment">//包含关系，差集即是非集，大减小即可。集合本身因为迭代特性所以本身就有序。</span></span><br><span class="line">        <span class="built_in">set_difference</span>(allset-&gt;<span class="built_in">begin</span>(),allset-&gt;<span class="built_in">end</span>(),smlset-&gt;<span class="built_in">begin</span>(),smlset-&gt;<span class="built_in">end</span>(),<span class="built_in">inserter</span>(resultset,resultset.<span class="built_in">begin</span>()));</span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; resultptr=make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;(resultset);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),resultptr,sml.<span class="built_in">getfile</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    Query query;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>~ (<span class="type">const</span> Query &amp;operand)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">NotQuery</span>(operand));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query &amp;);</span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">BinaryQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp;r,string s):<span class="built_in">lhs</span>(l),<span class="built_in">rhs</span>(r),<span class="built_in">opSym</span>(s)&#123;&#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;~(&quot;</span>+lhs.<span class="built_in">rep</span>()+<span class="string">&quot; &quot;</span>+opSym+<span class="string">&quot; &quot;</span>+rhs.<span class="built_in">rep</span>()+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Query lhs,rhs;</span><br><span class="line">    string opSym;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrQuery</span> : <span class="keyword">public</span> BinaryQuery&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> |(<span class="type">const</span> Query &amp;,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">OrQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">OrQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp; r):<span class="built_in">BinaryQuery</span>(l,r,<span class="string">&quot;|&quot;</span>)&#123;&#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">//两个成员分别lhs,rhs。求并集不妨找他们返回的set的共享指针，然后用算法求</span></span><br><span class="line">        <span class="comment">//lhs和rhs都是WordQuery</span></span><br><span class="line">        <span class="keyword">auto</span> r=rhs.<span class="built_in">eval</span>(text),l=lhs.<span class="built_in">eval</span>(text);</span><br><span class="line">        <span class="keyword">auto</span> retlines=l.<span class="built_in">getset</span>();</span><br><span class="line">        retlines-&gt;<span class="built_in">insert</span>(r.<span class="built_in">getset</span>()-&gt;<span class="built_in">begin</span>(),r.<span class="built_in">getset</span>()-&gt;<span class="built_in">end</span>());<span class="comment">//左侧的插入右侧形成并集</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),retlines,l.<span class="built_in">getfile</span>());<span class="comment">//两个file都一样</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>| (<span class="type">const</span> Query &amp;lhs,<span class="type">const</span> Query &amp;rhs)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">OrQuery</span>(lhs,rhs));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndQuery</span> : <span class="keyword">public</span> BinaryQuery&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> &amp;(<span class="type">const</span> Query &amp;,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">AndQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">AndQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp; r):<span class="built_in">BinaryQuery</span>(l,r,<span class="string">&quot;&amp;&quot;</span>)&#123;&#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">//两个成员分别lhs,rhs。求交集不妨找他们返回的set的共享指针，然后用算法求</span></span><br><span class="line">        <span class="comment">//lhs和rhs都是WordQuery</span></span><br><span class="line">        <span class="keyword">auto</span> r=rhs.<span class="built_in">eval</span>(text),l=lhs.<span class="built_in">eval</span>(text);<span class="comment">//R和L是ResultQE</span></span><br><span class="line">        <span class="keyword">auto</span> lset=l.<span class="built_in">getset</span>(),rset=r.<span class="built_in">getset</span>();</span><br><span class="line">        set&lt;<span class="type">unsigned</span>&gt; resultset;</span><br><span class="line">        <span class="built_in">set_intersection</span>(lset-&gt;<span class="built_in">begin</span>(),lset-&gt;<span class="built_in">end</span>(),rset-&gt;<span class="built_in">begin</span>(),rset-&gt;<span class="built_in">end</span>(),<span class="built_in">inserter</span>(resultset,resultset.<span class="built_in">begin</span>()));</span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; resultptr=make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;(resultset);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),resultptr,l.<span class="built_in">getfile</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>&amp; (<span class="type">const</span> Query &amp;lhs,<span class="type">const</span> Query &amp;rhs)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">AndQuery</span>(lhs,rhs));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="sBBTg"><font style="color:rgb(0,0,0);">关于文件资源管理的类(RAII的思想体现）</font></h4>

<p>对于ofstream和ifstream，设计了对应的类管理对象，这样可以让其在不需要的时候调用析构函数。</p>
<p>在构造函数设计了一些东西，比如如果文件流已打开怎么处理，以及文件是否需要覆写。</p>
<p>以及获取当前管理文件流引用的方法，方便其他类方法的传参。</p>
<p>对于FileFormatter是为了实现需求4而设计，含有IFileStream和OfileStream的对象。</p>
<p>首先读取ifstream里的文章是以单词形式读取，这是为了方便格式化处理，让单词一个一个拼接。拼接好了达到要求就放到一个string，然后放到本类的vector<string> newbuf存储，之后再将句子写到ofstream流里即可。</p>
<p>如果下一个句子有句号开头的情况，就直接拼接到本次string后面</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">OFileStream</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    string FilePath;</span><br><span class="line">    ofstream ofile;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">OFileStream</span>(<span class="type">const</span> string &amp;name)&#123;</span><br><span class="line">        ofile.<span class="built_in">close</span>();</span><br><span class="line">        FilePath=name;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">FileExists</span>(name))&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;文件存在，是否进行覆写？(Y/N):&quot;</span>;</span><br><span class="line">            <span class="type">char</span> response;</span><br><span class="line">            cin&gt;&gt;response;</span><br><span class="line">            cin.<span class="built_in">ignore</span>();</span><br><span class="line">            <span class="keyword">if</span>(response==<span class="string">&#x27;Y&#x27;</span>||response==<span class="string">&#x27;y&#x27;</span>)&#123;</span><br><span class="line">                ofile.<span class="built_in">close</span>();</span><br><span class="line">                ofile.<span class="built_in">open</span>(name,ios::out);</span><br><span class="line">                <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                    cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;成功打开，请写入 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;打开出现异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;保留原有文件，不进行操作&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//文件不存在的情况</span></span><br><span class="line">            ofile.<span class="built_in">close</span>();</span><br><span class="line">            ofile.<span class="built_in">open</span>(name,ios::out);</span><br><span class="line">            <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;成功打开，请写入 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">char</span> ch=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">throw</span> ch;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">OFileStream</span>()&#123;</span><br><span class="line">        FilePath=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;</span><br><span class="line">            ofile.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ofstream&amp; <span class="title">getofsteram</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ofile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//文件读取操作流</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IFileStream</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    string FilePath;</span><br><span class="line">    ifstream ifile;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">IFileStream</span>(<span class="type">const</span> string &amp;name)&#123;</span><br><span class="line">        FilePath=name;</span><br><span class="line">        <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;已被打开过... :|&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ifile.<span class="built_in">open</span>(name);</span><br><span class="line">            <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;可以读取 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                string something=<span class="string">&quot;文件&quot;</span>+name+<span class="string">&quot;读取出现异常,不存在的路径 :(&quot;</span>;</span><br><span class="line">                <span class="keyword">throw</span> something;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">IFileStream</span>()&#123;</span><br><span class="line">        FilePath=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;</span><br><span class="line">            ifile.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ifstream&amp; <span class="title">getifsteram</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ifile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileFormatter</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    OFileStream ost;</span><br><span class="line">    IFileStream ist;</span><br><span class="line">    vector&lt;string&gt; vecbuf;</span><br><span class="line">    vector&lt;string&gt; newbuf;</span><br><span class="line">    <span class="type">unsigned</span> num;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileFormatter</span>(<span class="type">const</span> string FilePath,<span class="type">const</span> string newFilePath,<span class="type">unsigned</span> n):<span class="built_in">ist</span>(FilePath),<span class="built_in">ost</span>(newFilePath),<span class="built_in">num</span>(n),<span class="built_in">vecbuf</span>(),<span class="built_in">newbuf</span>()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">readFromFile</span><span class="params">()</span><span class="comment">//读取源文件</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//ist是读取文件的留，我们利用它把文件读取到指定的容器vector中。</span></span><br><span class="line">    <span class="comment">//然后再对其进行格式化。所以此函数的作用就是将ist的内容读取出来放到vector中。</span></span><br><span class="line">        <span class="comment">//如果文件不存在，初始化的时候会报错</span></span><br><span class="line">        <span class="comment">//该函数作用域结束后会调用析构函数，不会造成资源浪费。</span></span><br><span class="line">        stringstream ss;</span><br><span class="line">        string temp,t;</span><br><span class="line">        <span class="type">char</span> c[num+<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">getline</span>(ist.<span class="built_in">getifsteram</span>(),temp))&#123;</span><br><span class="line">           <span class="comment">//temp=c;</span></span><br><span class="line">           ss&lt;&lt;temp;</span><br><span class="line">           <span class="keyword">while</span>(ss &gt;&gt; t)&#123;</span><br><span class="line">                vecbuf.<span class="built_in">push_back</span>(t);<span class="comment">//把每个单词放在容器里。</span></span><br><span class="line">           &#125;</span><br><span class="line">           ss.<span class="built_in">clear</span>();<span class="comment">//提取完一行清除字符串流</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">formatText</span><span class="params">()</span><span class="comment">//格式化字符句子</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//如果单词字符数大于n，则单独独占一行</span></span><br><span class="line">        <span class="comment">//外层循环的结束条件是vector是否用完</span></span><br><span class="line">        <span class="keyword">while</span>(vecbuf.<span class="built_in">size</span>())&#123;</span><br><span class="line">            string str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(vecbuf.<span class="built_in">front</span>().<span class="built_in">length</span>()&gt;=num)&#123;</span><br><span class="line">                newbuf.<span class="built_in">push_back</span>(vecbuf.<span class="built_in">front</span>());</span><br><span class="line">                vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());<span class="comment">//删除第一个元素</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(str.<span class="built_in">length</span>()&lt;num)&#123;<span class="comment">//对于一个句子，当前句子长度+单词长度大于num就不执行了</span></span><br><span class="line">                <span class="type">bool</span> flag=vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;.&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;!&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;\&quot;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;,&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;:&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;?&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span>(str.<span class="built_in">length</span>()==<span class="number">0</span>)&#123; </span><br><span class="line">                        <span class="comment">//检测巨首是不是标点</span></span><br><span class="line">                        <span class="keyword">if</span>(flag)&#123;<span class="comment">//如果是标点符号，进行处理。</span></span><br><span class="line">                            cerr&lt;&lt;<span class="string">&quot;句首出现标点符号&quot;</span>&lt;&lt;endl;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                            str=vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                            vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="comment">//如果小于，就继续做</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>((str.<span class="built_in">length</span>()+vecbuf.<span class="built_in">front</span>().<span class="built_in">length</span>()+<span class="number">1</span>)&lt;=num&amp;&amp;!flag)&#123;<span class="comment">//句子加单词长度大于num，而不是加符号</span></span><br><span class="line">                        <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                            str=str+<span class="string">&quot; &quot;</span>+vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                            vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                        <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;<span class="comment">//如果句尾是标点连着的话，就连续处理</span></span><br><span class="line">                                str=str+<span class="string">&quot; &quot;</span>+vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                                vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                                flag=vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;.&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;!&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;\&quot;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;,&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;:&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;?&quot;</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                flag=<span class="literal">false</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                newbuf.<span class="built_in">push_back</span>(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">saveToFile</span><span class="params">()</span><span class="comment">//将格式化后的文本内容保存到新的位置和文件名。</span></span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        ofstream&amp; outfile=ost.<span class="built_in">getofsteram</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> string &amp;s:newbuf)&#123;</span><br><span class="line">            outfile&lt;&lt;s&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="WTL9t"><font style="color:rgb(0,0,0);">解析需求3,4,5</font></h3>

<p>:::info</p>
<ol start="3">
<li><font style="color:rgb(0,0,0);">程序实现两个功能，一个是</font><strong><font style="color:rgb(0,0,0);">文件格式化</font></strong><font style="color:rgb(0,0,0);">功能，另一个是</font><strong><font style="color:rgb(0,0,0);">文本查询</font></strong><font style="color:rgb(0,0,0);">功能，打开程序时可以选择功能，类似如下 </font></li>
</ol>
<p><font style="color:rgb(0,0,0);">选择需要的功能： </font></p>
<p><font style="color:rgb(0,0,0);">1. </font><font style="color:rgb(0,0,0);">文件格式化 </font></p>
<p><font style="color:rgb(0,0,0);">2. </font><font style="color:rgb(0,0,0);">文本查询 </font></p>
<p><font style="color:rgb(0,0,0);">3. 退出 </font></p>
<p>:::</p>
<p>main函数就是针对需求3来设计，然后该读取的读取，该调用对的调用，以及可能涉及到的一些异常处理。</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704529617060-c79e7bd4-da7a-4d43-bf1f-115b0b6a9eec.png"></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//对输入的buf进行判别</span></span><br><span class="line">    <span class="type">int</span> cho;</span><br><span class="line">    string buf;</span><br><span class="line"></span><br><span class="line">    string newbuf;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">menu</span>();</span><br><span class="line">        cin&gt;&gt;cho;</span><br><span class="line">        cin.<span class="built_in">ignore</span>();</span><br><span class="line">        <span class="keyword">switch</span> (cho)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//让用户输入路径</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请输入读取的文件路径&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,buf);</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请指定每行最大的字符数n :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt;&quot;</span>;</span><br><span class="line">                <span class="type">int</span> num;</span><br><span class="line">                cin&gt;&gt;num;</span><br><span class="line">                cin.<span class="built_in">ignore</span>();</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请指定新文件保存的路径 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt;&quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,newbuf);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    ff=<span class="built_in">make_shared</span>&lt;FileFormatter&gt;(buf,newbuf,num);</span><br><span class="line">                    ff-&gt;<span class="built_in">readFromFile</span>();</span><br><span class="line">                    ff-&gt;formatText();</span><br><span class="line">                    ff-&gt;<span class="built_in">saveToFile</span>();</span><br><span class="line">                &#125;<span class="built_in">catch</span>(string str)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;错误的文件路径&quot;</span>&lt;&lt;buf&lt;&lt;<span class="string">&quot;导致打开异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;<span class="built_in">catch</span>(<span class="type">char</span> ch)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;错误的文件路径&quot;</span>&lt;&lt;buf&lt;&lt;<span class="string">&quot;导致写入异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请输入读取的文件路径&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,newbuf);<span class="comment">//buf就是路径</span></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    ifs=<span class="built_in">make_shared</span>&lt;IFileStream&gt;(newbuf);</span><br><span class="line">                    cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                    <span class="built_in">getline</span>(cin,buf);<span class="comment">//从输入流中读取一行数据到buf</span></span><br><span class="line">                    <span class="built_in">BlankFliter</span>(buf);<span class="comment">//首先排除空格的影响</span></span><br><span class="line">                    <span class="built_in">StringTraslate</span>(buf);</span><br><span class="line">                &#125;<span class="built_in">catch</span>(string str)&#123;</span><br><span class="line">                    cerr&lt;&lt;str;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;无效的选项:(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>:::info<br><font style="color:rgb(0,0,0);">4. </font><font style="color:rgb(0,0,0);">进入文件格式化功能，程序会根据用户后续输入的文件位置（绝对地址或相对地址）和文 </font></p>
<p><font style="color:rgb(0,0,0);">件名读取文件，并由用户指定每行最大字符数</font><font style="color:rgb(0,0,0);"> n</font><font style="color:rgb(0,0,0);">，处理文件，使得文件在行数到达</font><font style="color:rgb(0,0,0);"> n </font><font style="color:rgb(0,0,0);">时进 </font></p>
<p><font style="color:rgb(0,0,0);">行换行（若为英文，需要切断单词时，提前换行，避免单词被切断，且需使得标点符号不 </font></p>
<p><font style="color:rgb(0,0,0);">在行首），并由用户指定保存新文件的位置与新文件名，若位置与新文件名已存在，由用 </font></p>
<p><font style="color:rgb(0,0,0);">户确认是否替换（原有文件内容不可改变，除非新文件与原文件在相同位置且有相同文件 </font></p>
<p><font style="color:rgb(0,0,0);">名，并被确认替换）。 </font></p>
<p>:::</p>
<p>调用在main的代码已经写了，对应FileFormatter类的设计已在需求2展示，这里直接展示结果</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704532241776-c17d27f3-7fed-4b78-92fd-53114aac86bc.png"></p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704532171956-431bee23-b70c-45a8-a252-a03f34a9141c.png"></p>
<p>:::info<br><font style="color:rgb(0,0,0);">5. </font><font style="color:rgb(0,0,0);">文本查询允许用户指定一个文件（给定文件位置与文件名），并在其中查询单词，查询结 </font></p>
<p><font style="color:rgb(0,0,0);">果是单词在文件中出现的次数及其所在行的列表。如果一个单词在一行中出现多次，此行 </font></p>
<p><font style="color:rgb(0,0,0);">只列出一次。行会按照升序输出，即第</font><font style="color:rgb(0,0,0);">7</font><font style="color:rgb(0,0,0);">行会在第</font><font style="color:rgb(0,0,0);">9</font><font style="color:rgb(0,0,0);">行之前显示，以此类推。如果查询不 </font></p>
<p><font style="color:rgb(0,0,0);">到，则不输出。例如，在读取一个文件后，在其中寻找单词</font><font style="color:rgb(0,0,0);">element</font><font style="color:rgb(0,0,0);">时，输出结果的前几行 </font></p>
<p><font style="color:rgb(0,0,0);">应该类似这样： </font></p>
<p><font style="color:rgb(0,0,0);">&gt;&gt;&gt; element </font></p>
<p><font style="color:rgb(163,21,21);">“element” </font><font style="color:rgb(0,0,0);">出现 112 次 </font></p>
<p><font style="color:rgb(0,0,0);"> (line 36) An element contains only a key; </font></p>
<p><font style="color:rgb(0,0,0);"> (line 158) operator creates a new element </font></p>
<p><font style="color:rgb(0,0,0);"> (line 160) Regardless of whether the element </font></p>
<p><font style="color:rgb(0,0,0);"> (line 168) When we fetch an element from a map, we </font></p>
<p><font style="color:rgb(0,0,0);"> (line 214) If the element is not found, find returns</font></p>
<p>:::</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523984530-c577a032-a2fd-4e93-b06d-5651ebcdb138.png"></p>
<p>结果如图，相对应的函数，定义了一个StringTraslate和ExpTraslate函数实现对应的效果，以及一些辅助函数如空格过滤，判断输入的字符串是变量还是常量等。</p>
<p>StringTraslate主要是按照操作符分割字符串，已经判断是查询操作还是赋值操作</p>
<p>ExpTraslate先是把StringTraslate处理后的字符串设法转换成后缀表达式，然后利用栈完成运算（利用栈也是为了支持复杂运算）。</p>
<p>对应的栈结构声明为stack&lt;shared_ptr<Query>&gt;，这样就不会因为生存周期的问题造成非法内存访问。</p>
<p>最后ExpTraslate调用 qstack.top()-&gt;eval(TextQuery(ifs-&gt;getifsteram())).print();相关的语句，就可以完成结果效果</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br></pre></td><td class="code"><pre><span class="line">shared_ptr&lt;IFileStream&gt; ifs;</span><br><span class="line">shared_ptr&lt;FileFormatter&gt; ff;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BlankFliter</span><span class="params">(string &amp;str)</span><span class="comment">//使用C++string类的方法快速删除空格</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//std::remove_if函数用于将所有空白字符移动到字符串的末尾，</span></span><br><span class="line">    <span class="comment">//然后使用erase函数将它们从字符串中删除。</span></span><br><span class="line">    <span class="comment">//::isspace函数是一个标准库函数，用于检查一个字符是否为空白字符。</span></span><br><span class="line">    str.<span class="built_in">erase</span>(std::<span class="built_in">remove_if</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), ::isspace), str.<span class="built_in">end</span>()); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ExpTraslate</span><span class="params">(string &amp;buf)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">IsNameReturn</span><span class="params">(string &amp;buf)</span></span>&#123;<span class="comment">//针对一个单词的一次性检查</span></span><br><span class="line">    string result;</span><br><span class="line">    <span class="keyword">auto</span> iter = umap.<span class="built_in">find</span>(buf);</span><br><span class="line">    <span class="keyword">if</span>(iter!=umap.<span class="built_in">end</span>())&#123;</span><br><span class="line">        result=iter-&gt;second;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StringTraslate</span><span class="params">(string &amp;buf)</span><span class="comment">//处理用户输入的字符串</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//首先判断是否执行 查询操作</span></span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">0</span>]==<span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">        buf.<span class="built_in">erase</span>(buf.<span class="built_in">begin</span>());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//然后判断是否执行 赋值 操作</span></span><br><span class="line">    <span class="type">int</span> temp=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> times=<span class="number">0</span>;</span><br><span class="line">    string name,value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;buf.<span class="built_in">size</span>()<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;&gt;&#x27;</span>&amp;&amp;buf[i+<span class="number">1</span>]==<span class="string">&#x27;&gt;&#x27;</span>)&#123;  </span><br><span class="line">            filename=buf.<span class="built_in">substr</span>(i+<span class="number">2</span>,buf.<span class="built_in">size</span>()-i<span class="number">-2</span>);</span><br><span class="line">            buf=buf.<span class="built_in">substr</span>(<span class="number">0</span>,i);<span class="comment">//前面是查询的单词</span></span><br><span class="line">            filesearch=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;buf.<span class="built_in">length</span>();i++)&#123;<span class="comment">//跳过第一个字符，检查是否有赋值操作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;buf.<span class="built_in">length</span>();j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(buf[j]==<span class="string">&#x27;\&quot;&#x27;</span>&amp;&amp;times==<span class="number">0</span>)&#123;<span class="comment">//找到&quot;说明是常量</span></span><br><span class="line">                    temp=j+<span class="number">1</span>;</span><br><span class="line">                    times++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buf[j]==<span class="string">&#x27;\&quot;&#x27;</span>&amp;&amp;times==<span class="number">1</span>)&#123;</span><br><span class="line">                    value=buf.<span class="built_in">substr</span>(temp,j-temp);</span><br><span class="line">                    times++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(j==buf.<span class="built_in">length</span>()<span class="number">-1</span>)&#123;<span class="comment">//找到最后一位的时候，说明这可能是个变量</span></span><br><span class="line">                    string qwq=buf.<span class="built_in">substr</span>(temp,j-temp);</span><br><span class="line">                    <span class="keyword">auto</span> iter = umap.<span class="built_in">find</span>(qwq);</span><br><span class="line">                    <span class="keyword">if</span>(iter!=umap.<span class="built_in">end</span>())&#123;</span><br><span class="line">                        value=iter-&gt;second;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        cerr&lt;&lt;<span class="string">&quot;输入了一个不存在的变量，如果需要输入常量abcd，请用\&quot;abcd\&quot;包裹常量abcd :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(times%<span class="number">2</span>)&#123;</span><br><span class="line">                cerr&lt;&lt;<span class="string">&quot;请确保\&quot;abcd\&quot;包裹常量abcd :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;</span><br><span class="line">            name=buf.<span class="built_in">substr</span>(<span class="number">0</span>,i);</span><br><span class="line">            umap[name]=value;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行表达式处理操作 操作分为分割和计算</span></span><br><span class="line">    <span class="built_in">ExpTraslate</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isOperater</span><span class="params">(string str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(str==<span class="string">&quot;|&quot;</span>||str==<span class="string">&quot;&amp;&quot;</span>||str==<span class="string">&quot;~&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Precedence</span><span class="params">(<span class="type">char</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;~&#x27;</span>) <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;&amp;&#x27;</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;|&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ExpTraslate</span><span class="params">(string &amp;buf)</span></span>&#123;<span class="comment">//可能出现错误，可以尝试异常处理</span></span><br><span class="line">    stack&lt;shared_ptr&lt;Query&gt;&gt; qstack;</span><br><span class="line">    stack&lt;<span class="type">char</span>&gt; opstack;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    vector&lt;string&gt; backexp;</span><br><span class="line">    <span class="type">int</span> word_start=<span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> last_right=buf[buf.<span class="built_in">size</span>()<span class="number">-1</span>]==<span class="string">&#x27;)&#x27;</span>;<span class="comment">//看在最后一个是不是右边括号</span></span><br><span class="line">    <span class="type">bool</span> Had_op=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> priority1;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;buf.<span class="built_in">size</span>();i++)&#123;<span class="comment">//分割字符串并转成后缀表达式</span></span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;~&#x27;</span>||buf[i]==<span class="string">&#x27;|&#x27;</span>||buf[i]==<span class="string">&#x27;&amp;&#x27;</span>||buf[i]==<span class="string">&#x27;(&#x27;</span>||buf[i]==<span class="string">&#x27;)&#x27;</span>)&#123;</span><br><span class="line">            Had_op=<span class="number">1</span>;</span><br><span class="line">            op=buf[i];</span><br><span class="line">            priority1=<span class="built_in">Precedence</span>(op);</span><br><span class="line">            <span class="keyword">if</span> (opstack.<span class="built_in">empty</span>()||op==<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">//或者左括号直接压栈</span></span><br><span class="line">                opstack.<span class="built_in">push</span>(op);</span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(op ==<span class="string">&#x27;)&#x27;</span>)&#123;<span class="comment">//如果当前位置是右括号</span></span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;<span class="comment">//排除()遇到)的情况</span></span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span>(!opstack.<span class="built_in">empty</span>()&amp;&amp;opstack.<span class="built_in">top</span>()!=<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">// 不断将栈中的元素弹出，直到遇到左括号</span></span><br><span class="line">                    <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!opstack.<span class="built_in">empty</span>()&amp;&amp;opstack.<span class="built_in">top</span>()==<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">//遇到左括号就将他弹出</span></span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式括号不匹配，请检查并重启程序 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="string">&#x27;~&#x27;</span>||op==<span class="string">&#x27;|&#x27;</span>||op==<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;<span class="comment">//排除(~a)遇到~的情况</span></span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span>((!opstack.<span class="built_in">empty</span>())&amp;&amp;(<span class="built_in">Precedence</span>(opstack.<span class="built_in">top</span>())&gt;=priority1))&#123;</span><br><span class="line">                    <span class="comment">// 如果栈不空，栈顶为运算符，并且栈顶运算符的优先级大于等于当前运算符的优先级</span></span><br><span class="line">                    <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//再将操作符压入栈</span></span><br><span class="line">                opstack.<span class="built_in">push</span>(op);</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="comment">//清空栈，放到后缀表达式</span></span><br><span class="line">    <span class="keyword">if</span>(!last_right)&#123;</span><br><span class="line">        backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,buf.<span class="built_in">size</span>()-word_start));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!opstack.<span class="built_in">empty</span>())&#123;<span class="comment">//如果op栈不空，弹出所有元素到后缀表达式</span></span><br><span class="line">        <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">        opstack.<span class="built_in">pop</span>();</span><br><span class="line">        backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!Had_op)&#123;<span class="comment">//没有运算符，直接走捷径</span></span><br><span class="line">        <span class="function">Query <span class="title">onetime</span><span class="params">(IsNameReturn(buf))</span></span>;</span><br><span class="line">        <span class="keyword">if</span>(filesearch)&#123;</span><br><span class="line">            <span class="function">OFileStream <span class="title">ofi</span><span class="params">(filename)</span></span>;</span><br><span class="line">            cout&lt;&lt;onetime.<span class="built_in">rep</span>()&lt;&lt;endl;</span><br><span class="line">            </span><br><span class="line">            onetime.<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">write</span>(ofi.<span class="built_in">getofsteram</span>());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            cout&lt;&lt;onetime.<span class="built_in">rep</span>()&lt;&lt;endl;</span><br><span class="line">            onetime.<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">print</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果有运算符，都在栈里面</span></span><br><span class="line">    <span class="keyword">while</span>(!backexp.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isOperater</span>(backexp.<span class="built_in">front</span>()))<span class="comment">//判断向量backexp里面的是不是运算符</span></span><br><span class="line">        &#123;</span><br><span class="line">            string opstr=backexp.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">if</span>(opstr==<span class="string">&quot;|&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="keyword">return</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp1=qstack.<span class="built_in">top</span>();</span><br><span class="line">                <span class="comment">//temp1=qstack.top();</span></span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; temp2=qstack.<span class="built_in">top</span>(); </span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(*temp1.<span class="built_in">get</span>()|*temp2.<span class="built_in">get</span>());</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opstr==<span class="string">&quot;&amp;&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="keyword">return</span> ;  </span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp1=qstack.<span class="built_in">top</span>();</span><br><span class="line">                <span class="comment">//temp1=qstack.top();</span></span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; temp2=qstack.<span class="built_in">top</span>();</span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(*temp1.<span class="built_in">get</span>()&amp;*temp2.<span class="built_in">get</span>());</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opstr==<span class="string">&quot;~&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">1</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl ; </span><br><span class="line">                    <span class="keyword">return</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp=qstack.<span class="built_in">top</span>();</span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(~(*temp.<span class="built_in">get</span>()));</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;</span><br><span class="line">            backexp.<span class="built_in">erase</span>(backexp.<span class="built_in">begin</span>());</span><br><span class="line">        &#125;<span class="comment">//如果不是则执行下面，将Query对象入栈</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            qstack.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;Query&gt;(<span class="built_in">IsNameReturn</span>(backexp.<span class="built_in">front</span>())));<span class="comment">//栈里面的都是共享指针</span></span><br><span class="line">            backexp.<span class="built_in">erase</span>(backexp.<span class="built_in">begin</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最后所有运算操作完成</span></span><br><span class="line">    <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(filesearch)&#123;</span><br><span class="line">            <span class="function">OFileStream <span class="title">ofi</span><span class="params">(filename)</span></span>;</span><br><span class="line">            qstack.<span class="built_in">top</span>()-&gt;<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">write</span>(ofi.<span class="built_in">getofsteram</span>());</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            qstack.<span class="built_in">top</span>()-&gt;<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">print</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        cerr&lt;&lt;<span class="string">&quot;表达式可能出现错误，无法运算出唯一结果&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







<h3 id="LFdEA">解析需求6</h3>


<p>:::info<br><font style="color:rgb(0,0,0);">文本查询功能可以通过交互式的方式保存用户输入的</font><strong><font style="color:rgb(0,0,0);">字符串</font></strong><font style="color:rgb(0,0,0);">（与项目二一样，忽略输入时 </font></p>
<p><font style="color:rgb(0,0,0);">的各种空格），并可以支持逻辑查询操作（各种逻辑运算）。</font><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523808550-09f668af-a43d-4bb2-a0d5-2118441545ce.png"><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523766560-fd64c2bb-e889-4f77-9423-6c76ff93fe72.png"><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704523843712-98b9fd63-9d0f-4ec7-9376-6f072db8fd50.png"></p>
<p>:::</p>
<p>还是老样子涉及到unordered_map</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">unordered_map&lt;string,string&gt;umap&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">string <span class="title">IsNameReturn</span><span class="params">(string &amp;buf)</span></span>&#123;<span class="comment">//针对一个单词的一次性检查是否是变量</span></span><br><span class="line">    string result;</span><br><span class="line">    <span class="keyword">auto</span> iter = umap.<span class="built_in">find</span>(buf);</span><br><span class="line">    <span class="keyword">if</span>(iter!=umap.<span class="built_in">end</span>())&#123;</span><br><span class="line">        result=iter-&gt;second;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nUiFV">解析需求7</h3>

<p>:::info<br><font style="color:rgb(0,0,0);">7. 要能够打印各种错误信息，比如用户输入不符合规范时。</font></p>
<p>:::</p>
<p>OFileStream和IFileStream里面都有对应的错误异常处理</p>
<p>输入的路径有问题，就返回主函数重新执行菜单</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540735494-f2cedcc8-0f5a-4de1-876b-55eb3a88d8ae.png"></p>
<p>输入的查询表达式有问题，返回主函数</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704541429865-d1f0af06-56a1-4acd-aee2-b382fbf76e76.png"><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540889279-4f1ec330-28f5-402e-b8d2-ae3716d72008.png"></p>
<h3 id="wWtmc">解析需求9</h3>

<p>:::info<br><font style="color:rgb(0,0,0);">9. </font><font style="color:rgb(0,0,0);">尝试支持带括号控制优先级的复杂运算（优先级参照</font><font style="color:rgb(0,0,0);">C++</font><font style="color:rgb(0,0,0);">运算符优先级），如 </font></p>
<p><font style="color:rgb(0,0,0);">&gt;&gt;&gt; ((~a | b &amp; c) | d) &amp; d</font></p>
<p>:::</p>
<p>利用栈就可以实现复杂表达式的运算，就是优先级的问题。代码在需求5已经贴出</p>
<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704540714628-b25c6efc-db46-4184-94bb-ab1cb59a1d3e.png"></p>
<h3 id="Hn8Uf">解析需求11</h3>

<p>可以看到能够成功写到文件中，其实就是字符串处理操作中，根据&gt;&gt;分割成前后部分，后面打开文件即可</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">QueryResult</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        string inputword;<span class="comment">//需要查询的单词</span></span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; idx;<span class="comment">//出现的行号</span></span><br><span class="line">        shared_ptr&lt;vector&lt;string&gt;&gt; file;<span class="comment">//查找的文件</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(ofstream&amp; ofs)</span></span>&#123;</span><br><span class="line">        ofs&lt;&lt;<span class="string">&quot;\&quot;&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;inputword&lt;&lt;<span class="string">&quot;\&quot;出现了&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;idx-&gt;<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot;次&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:*(<span class="keyword">this</span>-&gt;idx))&#123;</span><br><span class="line">            ofs&lt;&lt;<span class="string">&quot; (line &quot;</span>&lt;&lt;num+<span class="number">1</span>&lt;&lt;<span class="string">&quot;) &quot;</span>;</span><br><span class="line">            ofs&lt;&lt;*(<span class="keyword">this</span>-&gt;file-&gt;<span class="built_in">begin</span>()+num)&lt;&lt;endl;</span><br><span class="line">    &#125;</span><br><span class="line">	..........</span><br><span class="line">    ...........</span><br><span class="line">    .........</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://xswlhhh12345-blog-test.oss-cn-guangzhou.aliyuncs.com/img/1704542200925-6309bb02-72a2-430d-9780-4e2f5de6cd5d.png"></p>
<h1 id="p9gkH"><font style="color:rgb(0,0,0);">总结</font></h1>

<p>算是比较正常的完成了一个程序，有了正确的思路和设计方向就是省了很多纠错的时间，对类和对象的印象更加深刻了，以及多态继承等概念，还有共享指针的妙处就是跨越{}作用域给你传输数据。解决了上次没有解决复杂表达式的问题，果然还是直接设计面向对象的栈类型是最佳的，以及重载需要的操作符，让我们更加方便的对对象进行操作。复习了RAII和异常处理类操作，没有用上模板但是没关系，也不强求，看需求。</p>
<p>不足之处感觉就是没有完成所有任务，感觉还是自己不够下功夫。</p>
<p>看了C++prinmer的相关章节，认识到自己还是需要看一遍这本书的，对于内存操作感觉还是有点陌生，以及共享指针的用处，看了才知道怎么用。</p>
<h1 id="源代码"><a href="#源代码" class="headerlink" title="源代码"></a>源代码</h1><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br><span class="line">393</span><br><span class="line">394</span><br><span class="line">395</span><br><span class="line">396</span><br><span class="line">397</span><br><span class="line">398</span><br><span class="line">399</span><br><span class="line">400</span><br><span class="line">401</span><br><span class="line">402</span><br><span class="line">403</span><br><span class="line">404</span><br><span class="line">405</span><br><span class="line">406</span><br><span class="line">407</span><br><span class="line">408</span><br><span class="line">409</span><br><span class="line">410</span><br><span class="line">411</span><br><span class="line">412</span><br><span class="line">413</span><br><span class="line">414</span><br><span class="line">415</span><br><span class="line">416</span><br><span class="line">417</span><br><span class="line">418</span><br><span class="line">419</span><br><span class="line">420</span><br><span class="line">421</span><br><span class="line">422</span><br><span class="line">423</span><br><span class="line">424</span><br><span class="line">425</span><br><span class="line">426</span><br><span class="line">427</span><br><span class="line">428</span><br><span class="line">429</span><br><span class="line">430</span><br><span class="line">431</span><br><span class="line">432</span><br><span class="line">433</span><br><span class="line">434</span><br><span class="line">435</span><br><span class="line">436</span><br><span class="line">437</span><br><span class="line">438</span><br><span class="line">439</span><br><span class="line">440</span><br><span class="line">441</span><br><span class="line">442</span><br><span class="line">443</span><br><span class="line">444</span><br><span class="line">445</span><br><span class="line">446</span><br><span class="line">447</span><br><span class="line">448</span><br><span class="line">449</span><br><span class="line">450</span><br><span class="line">451</span><br><span class="line">452</span><br><span class="line">453</span><br><span class="line">454</span><br><span class="line">455</span><br><span class="line">456</span><br><span class="line">457</span><br><span class="line">458</span><br><span class="line">459</span><br><span class="line">460</span><br><span class="line">461</span><br><span class="line">462</span><br><span class="line">463</span><br><span class="line">464</span><br><span class="line">465</span><br><span class="line">466</span><br><span class="line">467</span><br><span class="line">468</span><br><span class="line">469</span><br><span class="line">470</span><br><span class="line">471</span><br><span class="line">472</span><br><span class="line">473</span><br><span class="line">474</span><br><span class="line">475</span><br><span class="line">476</span><br><span class="line">477</span><br><span class="line">478</span><br><span class="line">479</span><br><span class="line">480</span><br><span class="line">481</span><br><span class="line">482</span><br><span class="line">483</span><br><span class="line">484</span><br><span class="line">485</span><br><span class="line">486</span><br><span class="line">487</span><br><span class="line">488</span><br><span class="line">489</span><br><span class="line">490</span><br><span class="line">491</span><br><span class="line">492</span><br><span class="line">493</span><br><span class="line">494</span><br><span class="line">495</span><br><span class="line">496</span><br><span class="line">497</span><br><span class="line">498</span><br><span class="line">499</span><br><span class="line">500</span><br><span class="line">501</span><br><span class="line">502</span><br><span class="line">503</span><br><span class="line">504</span><br><span class="line">505</span><br><span class="line">506</span><br><span class="line">507</span><br><span class="line">508</span><br><span class="line">509</span><br><span class="line">510</span><br><span class="line">511</span><br><span class="line">512</span><br><span class="line">513</span><br><span class="line">514</span><br><span class="line">515</span><br><span class="line">516</span><br><span class="line">517</span><br><span class="line">518</span><br><span class="line">519</span><br><span class="line">520</span><br><span class="line">521</span><br><span class="line">522</span><br><span class="line">523</span><br><span class="line">524</span><br><span class="line">525</span><br><span class="line">526</span><br><span class="line">527</span><br><span class="line">528</span><br><span class="line">529</span><br><span class="line">530</span><br><span class="line">531</span><br><span class="line">532</span><br><span class="line">533</span><br><span class="line">534</span><br><span class="line">535</span><br><span class="line">536</span><br><span class="line">537</span><br><span class="line">538</span><br><span class="line">539</span><br><span class="line">540</span><br><span class="line">541</span><br><span class="line">542</span><br><span class="line">543</span><br><span class="line">544</span><br><span class="line">545</span><br><span class="line">546</span><br><span class="line">547</span><br><span class="line">548</span><br><span class="line">549</span><br><span class="line">550</span><br><span class="line">551</span><br><span class="line">552</span><br><span class="line">553</span><br><span class="line">554</span><br><span class="line">555</span><br><span class="line">556</span><br><span class="line">557</span><br><span class="line">558</span><br><span class="line">559</span><br><span class="line">560</span><br><span class="line">561</span><br><span class="line">562</span><br><span class="line">563</span><br><span class="line">564</span><br><span class="line">565</span><br><span class="line">566</span><br><span class="line">567</span><br><span class="line">568</span><br><span class="line">569</span><br><span class="line">570</span><br><span class="line">571</span><br><span class="line">572</span><br><span class="line">573</span><br><span class="line">574</span><br><span class="line">575</span><br><span class="line">576</span><br><span class="line">577</span><br><span class="line">578</span><br><span class="line">579</span><br><span class="line">580</span><br><span class="line">581</span><br><span class="line">582</span><br><span class="line">583</span><br><span class="line">584</span><br><span class="line">585</span><br><span class="line">586</span><br><span class="line">587</span><br><span class="line">588</span><br><span class="line">589</span><br><span class="line">590</span><br><span class="line">591</span><br><span class="line">592</span><br><span class="line">593</span><br><span class="line">594</span><br><span class="line">595</span><br><span class="line">596</span><br><span class="line">597</span><br><span class="line">598</span><br><span class="line">599</span><br><span class="line">600</span><br><span class="line">601</span><br><span class="line">602</span><br><span class="line">603</span><br><span class="line">604</span><br><span class="line">605</span><br><span class="line">606</span><br><span class="line">607</span><br><span class="line">608</span><br><span class="line">609</span><br><span class="line">610</span><br><span class="line">611</span><br><span class="line">612</span><br><span class="line">613</span><br><span class="line">614</span><br><span class="line">615</span><br><span class="line">616</span><br><span class="line">617</span><br><span class="line">618</span><br><span class="line">619</span><br><span class="line">620</span><br><span class="line">621</span><br><span class="line">622</span><br><span class="line">623</span><br><span class="line">624</span><br><span class="line">625</span><br><span class="line">626</span><br><span class="line">627</span><br><span class="line">628</span><br><span class="line">629</span><br><span class="line">630</span><br><span class="line">631</span><br><span class="line">632</span><br><span class="line">633</span><br><span class="line">634</span><br><span class="line">635</span><br><span class="line">636</span><br><span class="line">637</span><br><span class="line">638</span><br><span class="line">639</span><br><span class="line">640</span><br><span class="line">641</span><br><span class="line">642</span><br><span class="line">643</span><br><span class="line">644</span><br><span class="line">645</span><br><span class="line">646</span><br><span class="line">647</span><br><span class="line">648</span><br><span class="line">649</span><br><span class="line">650</span><br><span class="line">651</span><br><span class="line">652</span><br><span class="line">653</span><br><span class="line">654</span><br><span class="line">655</span><br><span class="line">656</span><br><span class="line">657</span><br><span class="line">658</span><br><span class="line">659</span><br><span class="line">660</span><br><span class="line">661</span><br><span class="line">662</span><br><span class="line">663</span><br><span class="line">664</span><br><span class="line">665</span><br><span class="line">666</span><br><span class="line">667</span><br><span class="line">668</span><br><span class="line">669</span><br><span class="line">670</span><br><span class="line">671</span><br><span class="line">672</span><br><span class="line">673</span><br><span class="line">674</span><br><span class="line">675</span><br><span class="line">676</span><br><span class="line">677</span><br><span class="line">678</span><br><span class="line">679</span><br><span class="line">680</span><br><span class="line">681</span><br><span class="line">682</span><br><span class="line">683</span><br><span class="line">684</span><br><span class="line">685</span><br><span class="line">686</span><br><span class="line">687</span><br><span class="line">688</span><br><span class="line">689</span><br><span class="line">690</span><br><span class="line">691</span><br><span class="line">692</span><br><span class="line">693</span><br><span class="line">694</span><br><span class="line">695</span><br><span class="line">696</span><br><span class="line">697</span><br><span class="line">698</span><br><span class="line">699</span><br><span class="line">700</span><br><span class="line">701</span><br><span class="line">702</span><br><span class="line">703</span><br><span class="line">704</span><br><span class="line">705</span><br><span class="line">706</span><br><span class="line">707</span><br><span class="line">708</span><br><span class="line">709</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;sstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;fstream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;memory&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;unordered_map&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;set&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="keyword">include</span> <span class="string">&lt;algorithm&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> std;</span><br><span class="line"><span class="meta">#<span class="keyword">define</span> MAX 1024</span></span><br><span class="line">unordered_map&lt;string,string&gt;umap&#123;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">string <span class="title">IsNameReturn</span><span class="params">(string &amp;buf)</span></span>;</span><br><span class="line">string filename;</span><br><span class="line"><span class="type">bool</span> filesearch=<span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">FileExists</span><span class="params">(<span class="type">const</span> string&amp; filename)</span> </span>&#123;</span><br><span class="line">    <span class="function">ifstream <span class="title">file</span><span class="params">(filename)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> file.<span class="built_in">good</span>();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//返回的结果类</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryResult</span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">        string inputword;<span class="comment">//需要查询的单词</span></span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; idx;<span class="comment">//出现的行号</span></span><br><span class="line">        shared_ptr&lt;vector&lt;string&gt;&gt; file;<span class="comment">//查找的文件</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">QueryResult</span>(string s,shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; i,shared_ptr&lt;vector&lt;string&gt;&gt; f):<span class="built_in">inputword</span>(s),<span class="built_in">idx</span>(i),<span class="built_in">file</span>(f)&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">print</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        cout&lt;&lt;<span class="string">&quot;\&quot;&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;inputword&lt;&lt;<span class="string">&quot;\&quot;出现了&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;idx-&gt;<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot;次&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="comment">//打印出现的每一行</span></span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:*(<span class="keyword">this</span>-&gt;idx))&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot; (line &quot;</span>&lt;&lt;num+<span class="number">1</span>&lt;&lt;<span class="string">&quot;) &quot;</span>;</span><br><span class="line">            cout&lt;&lt;*(<span class="keyword">this</span>-&gt;file-&gt;<span class="built_in">begin</span>()+num)&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">write</span><span class="params">(ofstream&amp; ofs)</span></span>&#123;</span><br><span class="line">        ofs&lt;&lt;<span class="string">&quot;\&quot;&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;inputword&lt;&lt;<span class="string">&quot;\&quot;出现了&quot;</span>&lt;&lt;<span class="keyword">this</span>-&gt;idx-&gt;<span class="built_in">size</span>()&lt;&lt;<span class="string">&quot;次&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="keyword">for</span>(<span class="keyword">auto</span> num:*(<span class="keyword">this</span>-&gt;idx))&#123;</span><br><span class="line">            ofs&lt;&lt;<span class="string">&quot; (line &quot;</span>&lt;&lt;num+<span class="number">1</span>&lt;&lt;<span class="string">&quot;) &quot;</span>;</span><br><span class="line">            ofs&lt;&lt;*(<span class="keyword">this</span>-&gt;file-&gt;<span class="built_in">begin</span>()+num)&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// for(const string &amp;s:newbuf)&#123;</span></span><br><span class="line">        <span class="comment">//     ofs&lt;&lt;s&lt;&lt;endl;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">    shared_ptr&lt;vector&lt;string&gt;&gt; <span class="built_in">getfile</span>()&#123;<span class="comment">//返回file的共享指针</span></span><br><span class="line">        <span class="keyword">return</span> file;</span><br><span class="line">    &#125;</span><br><span class="line">    shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">getset</span>()&#123;<span class="comment">//返回行号的共享指针</span></span><br><span class="line">        <span class="keyword">return</span> idx;</span><br><span class="line">    &#125;</span><br><span class="line">    shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">getfileset</span>()&#123;<span class="comment">//返回整体行号的共享指针</span></span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; fileset =make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;();;</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;file-&gt;<span class="built_in">size</span>();i++)&#123;</span><br><span class="line">            fileset-&gt;<span class="built_in">insert</span>(i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> fileset;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">TextQuery</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    shared_ptr&lt;vector&lt;string&gt;&gt; file;<span class="comment">//存储文章的向量只能得指针</span></span><br><span class="line">    map&lt;string,shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;&gt; wordmap;<span class="comment">//用unsigned存储行号</span></span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="comment">//初始化需要一个文件流。</span></span><br><span class="line">    <span class="built_in">TextQuery</span>(ifstream&amp; is):<span class="built_in">file</span>(<span class="keyword">new</span> vector&lt;string&gt;)<span class="comment">//对文件流的单词句子进行解读</span></span><br><span class="line">    &#123;</span><br><span class="line">        string text;</span><br><span class="line">        <span class="keyword">while</span>(<span class="built_in">getline</span>(is,text))<span class="comment">//获取每一行</span></span><br><span class="line">        &#123;<span class="comment">//file是一个vector对象</span></span><br><span class="line">            file-&gt;<span class="built_in">push_back</span>(text);</span><br><span class="line">            <span class="type">int</span> n=file-&gt;<span class="built_in">size</span>()<span class="number">-1</span>;<span class="comment">//也就是行号？下标？</span></span><br><span class="line">            <span class="function">istringstream <span class="title">line</span><span class="params">(text)</span></span>;</span><br><span class="line">            string word;</span><br><span class="line">            <span class="keyword">while</span>(line &gt;&gt; word)<span class="comment">//用string这个流分解单词</span></span><br><span class="line">            &#123;<span class="comment">//匹配每一个单词</span></span><br><span class="line">                shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; lines;<span class="comment">//map的值是一个(set对象的)智能指针</span></span><br><span class="line">                <span class="keyword">if</span>(!wordmap.<span class="built_in">count</span>(word))&#123;<span class="comment">//如果不存在，说明是新单词，开辟一个set空间，并初始化</span></span><br><span class="line">                    lines = make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;();</span><br><span class="line">                    wordmap[word] = lines;</span><br><span class="line">                &#125;</span><br><span class="line">                wordmap[word]-&gt;<span class="built_in">insert</span>(n);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">query</span><span class="params">(<span class="type">const</span> string&amp; inputword)</span><span class="type">const</span><span class="comment">//返回查找结果，查找结果是一个queryRE对象</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//如果未找到，就直接返回一个指向空的set的set共享指针</span></span><br><span class="line">        <span class="type">static</span> shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; <span class="built_in">nodata</span>(<span class="keyword">new</span> <span class="built_in">set</span>&lt;<span class="type">unsigned</span>&gt;());<span class="comment">//返回智能指针指向空set</span></span><br><span class="line">        <span class="keyword">auto</span> loc=wordmap.<span class="built_in">find</span>(inputword);</span><br><span class="line">        <span class="keyword">if</span>(loc == wordmap.<span class="built_in">end</span>())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">QueryResult</span>(inputword,nodata,file);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">QueryResult</span>(inputword,loc-&gt;second,file);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">QueryBase</span>&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Query</span>;</span><br><span class="line"><span class="keyword">protected</span>:</span><br><span class="line">    <span class="type">unsigned</span> idx;</span><br><span class="line">    <span class="keyword">virtual</span> ~<span class="built_in">QueryBase</span>()&#123;&#125;;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery&amp;)</span><span class="type">const</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">virtual</span> string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;&#125;<span class="comment">//生成用于查询的rep文本</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">WordQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> <span class="keyword">class</span> <span class="title class_">Query</span>;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">WordQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//构造函数，接收string</span></span><br><span class="line">    <span class="built_in">WordQuery</span>(<span class="type">const</span> string &amp;s):<span class="built_in">query_word</span>(s)&#123;&#125;</span><br><span class="line">    <span class="comment">//重载虚构函数</span></span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;t)</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> t.<span class="built_in">query</span>(query_word);<span class="comment">//wordquery返回的结果就是根据单词本身返回的QueryRE</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span> <span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> query_word;</span><br><span class="line">    &#125;</span><br><span class="line">    string query_word;</span><br><span class="line">    </span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Query</span>&#123;</span><br><span class="line">    <span class="comment">//对三个运算符友元</span></span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query&amp;);</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> |(<span class="type">const</span> Query&amp; ,<span class="type">const</span> Query &amp;);</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> &amp;(<span class="type">const</span> Query&amp; ,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="comment">//构造函数shared_ptr</span></span><br><span class="line">    <span class="comment">//传进来是 指向QueryBase类型的 共享指针</span></span><br><span class="line">    shared_ptr&lt;QueryBase&gt; q;<span class="comment">//指向基类的指针</span></span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">Query</span>(shared_ptr&lt;QueryBase&gt; query):<span class="built_in">q</span>(query)&#123;&#125;;</span><br><span class="line">    Query&amp; <span class="keyword">operator</span> =(<span class="type">const</span> Query&amp; que)&#123;</span><br><span class="line">        q=que.q;</span><br><span class="line">        <span class="keyword">return</span> *<span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">Query</span>(<span class="type">const</span> string &amp;s)&#123;</span><br><span class="line">        <span class="function">shared_ptr&lt;WordQuery&gt; <span class="title">ptr</span><span class="params">(<span class="keyword">new</span> WordQuery(s))</span></span>;</span><br><span class="line">        q=ptr;</span><br><span class="line">    &#125;<span class="comment">//传进来是string类型的 用来构建WordQuery,来创建Query的q成员</span></span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;t)</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q-&gt;<span class="built_in">eval</span>(t);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span> <span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> q-&gt;<span class="built_in">rep</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">friend</span> ostream &amp; <span class="keyword">operator</span>&lt;&lt;(ostream &amp;os,<span class="type">const</span> Query&amp; query)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">return</span> os &lt;&lt; query.<span class="built_in">rep</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NotQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">NotQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">NotQuery</span>(<span class="type">const</span> Query &amp;q):<span class="built_in">query</span>(q)&#123;&#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;~(&quot;</span>+query.<span class="built_in">rep</span>()+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp; text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="keyword">auto</span> sml=query.<span class="built_in">eval</span>(text);</span><br><span class="line">        <span class="keyword">auto</span> smlset=sml.<span class="built_in">getset</span>();</span><br><span class="line">        <span class="keyword">auto</span> allset=sml.<span class="built_in">getfileset</span>();</span><br><span class="line">        set&lt;<span class="type">unsigned</span>&gt; resultset;</span><br><span class="line">        <span class="comment">//包含关系，差集即是非集，大减小即可。集合本身因为迭代特性所以本身就有序。</span></span><br><span class="line">        <span class="built_in">set_difference</span>(allset-&gt;<span class="built_in">begin</span>(),allset-&gt;<span class="built_in">end</span>(),smlset-&gt;<span class="built_in">begin</span>(),smlset-&gt;<span class="built_in">end</span>(),<span class="built_in">inserter</span>(resultset,resultset.<span class="built_in">begin</span>()));</span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; resultptr=make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;(resultset);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),resultptr,sml.<span class="built_in">getfile</span>());</span><br><span class="line">    &#125;</span><br><span class="line">    Query query;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>~ (<span class="type">const</span> Query &amp;operand)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">NotQuery</span>(operand));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BinaryQuery</span> : <span class="keyword">public</span> QueryBase&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> ~(<span class="type">const</span> Query &amp;);</span><br><span class="line">    <span class="keyword">protected</span>:</span><br><span class="line">    <span class="built_in">BinaryQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp;r,string s):<span class="built_in">lhs</span>(l),<span class="built_in">rhs</span>(r),<span class="built_in">opSym</span>(s)&#123;&#125;</span><br><span class="line">    <span class="function">string <span class="title">rep</span><span class="params">()</span><span class="type">const</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;(&quot;</span>+lhs.<span class="built_in">rep</span>()+<span class="string">&quot; &quot;</span>+opSym+<span class="string">&quot; &quot;</span>+rhs.<span class="built_in">rep</span>()+<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Query lhs,rhs;</span><br><span class="line">    string opSym;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OrQuery</span> : <span class="keyword">public</span> BinaryQuery&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> |(<span class="type">const</span> Query &amp;,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">OrQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">OrQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp; r):<span class="built_in">BinaryQuery</span>(l,r,<span class="string">&quot;|&quot;</span>)&#123;&#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">//两个成员分别lhs,rhs。求并集不妨找他们返回的set的共享指针，然后用算法求</span></span><br><span class="line">        <span class="comment">//lhs和rhs都是WordQuery</span></span><br><span class="line">        <span class="keyword">auto</span> r=rhs.<span class="built_in">eval</span>(text),l=lhs.<span class="built_in">eval</span>(text);</span><br><span class="line">        <span class="keyword">auto</span> retlines=l.<span class="built_in">getset</span>();</span><br><span class="line">        retlines-&gt;<span class="built_in">insert</span>(r.<span class="built_in">getset</span>()-&gt;<span class="built_in">begin</span>(),r.<span class="built_in">getset</span>()-&gt;<span class="built_in">end</span>());<span class="comment">//左侧的插入右侧形成并集</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),retlines,l.<span class="built_in">getfile</span>());<span class="comment">//两个file都一样</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>| (<span class="type">const</span> Query &amp;lhs,<span class="type">const</span> Query &amp;rhs)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">OrQuery</span>(lhs,rhs));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AndQuery</span> : <span class="keyword">public</span> BinaryQuery&#123;</span><br><span class="line">    <span class="keyword">friend</span> Query <span class="keyword">operator</span> &amp;(<span class="type">const</span> Query &amp;,<span class="type">const</span> Query &amp;);</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">    ~<span class="built_in">AndQuery</span>() <span class="keyword">override</span>&#123;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">private</span>:</span><br><span class="line">    <span class="built_in">AndQuery</span>(<span class="type">const</span> Query &amp;l,<span class="type">const</span> Query &amp; r):<span class="built_in">BinaryQuery</span>(l,r,<span class="string">&quot;&amp;&quot;</span>)&#123;&#125;</span><br><span class="line">    <span class="function">QueryResult <span class="title">eval</span><span class="params">(<span class="type">const</span> TextQuery &amp;text)</span><span class="type">const</span> </span>&#123;</span><br><span class="line">        <span class="comment">//两个成员分别lhs,rhs。求交集不妨找他们返回的set的共享指针，然后用算法求</span></span><br><span class="line">        <span class="comment">//lhs和rhs都是WordQuery</span></span><br><span class="line">        <span class="keyword">auto</span> r=rhs.<span class="built_in">eval</span>(text),l=lhs.<span class="built_in">eval</span>(text);<span class="comment">//R和L是ResultQE</span></span><br><span class="line">        <span class="keyword">auto</span> lset=l.<span class="built_in">getset</span>(),rset=r.<span class="built_in">getset</span>();</span><br><span class="line">        set&lt;<span class="type">unsigned</span>&gt; resultset;</span><br><span class="line">        <span class="built_in">set_intersection</span>(lset-&gt;<span class="built_in">begin</span>(),lset-&gt;<span class="built_in">end</span>(),rset-&gt;<span class="built_in">begin</span>(),rset-&gt;<span class="built_in">end</span>(),<span class="built_in">inserter</span>(resultset,resultset.<span class="built_in">begin</span>()));</span><br><span class="line">        shared_ptr&lt;set&lt;<span class="type">unsigned</span>&gt;&gt; resultptr=make_shared&lt;set&lt;<span class="type">unsigned</span>&gt;&gt;(resultset);</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">QueryResult</span>(<span class="built_in">rep</span>(),resultptr,l.<span class="built_in">getfile</span>());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">inline</span> Query <span class="keyword">operator</span>&amp; (<span class="type">const</span> Query &amp;lhs,<span class="type">const</span> Query &amp;rhs)&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">shared_ptr</span>&lt;QueryBase&gt;(<span class="keyword">new</span> <span class="built_in">AndQuery</span>(lhs,rhs));</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//文件打开写入操作流</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OFileStream</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    string FilePath;</span><br><span class="line">    ofstream ofile;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">OFileStream</span>(<span class="type">const</span> string &amp;name)&#123;</span><br><span class="line">        ofile.<span class="built_in">close</span>();</span><br><span class="line">        FilePath=name;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">FileExists</span>(name))&#123;</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;文件存在，是否进行覆写？(Y/N):&quot;</span>;</span><br><span class="line">            <span class="type">char</span> response;</span><br><span class="line">            cin&gt;&gt;response;</span><br><span class="line">            cin.<span class="built_in">ignore</span>();</span><br><span class="line">            <span class="keyword">if</span>(response==<span class="string">&#x27;Y&#x27;</span>||response==<span class="string">&#x27;y&#x27;</span>)&#123;</span><br><span class="line">                ofile.<span class="built_in">close</span>();</span><br><span class="line">                ofile.<span class="built_in">open</span>(name,ios::out);</span><br><span class="line">                <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                    cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;成功打开，请写入 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;打开出现异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;保留原有文件，不进行操作&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//文件不存在的情况</span></span><br><span class="line">            ofile.<span class="built_in">close</span>();</span><br><span class="line">            ofile.<span class="built_in">open</span>(name,ios::out);</span><br><span class="line">            <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;成功打开，请写入 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="type">char</span> ch=<span class="string">&#x27;0&#x27;</span>;</span><br><span class="line">                <span class="keyword">throw</span> ch;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">OFileStream</span>()&#123;</span><br><span class="line">        FilePath=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ofile.<span class="built_in">is_open</span>())&#123;</span><br><span class="line">            ofile.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function">ofstream&amp; <span class="title">getofsteram</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ofile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//文件读取操作流</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">IFileStream</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    string FilePath;</span><br><span class="line">    ifstream ifile;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">IFileStream</span>(<span class="type">const</span> string &amp;name)&#123;</span><br><span class="line">        FilePath=name;</span><br><span class="line">        <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;已被打开过... :|&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            ifile.<span class="built_in">open</span>(name);</span><br><span class="line">            <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;<span class="comment">//判断文件是否已经创建流</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;文件&quot;</span>&lt;&lt;name&lt;&lt;<span class="string">&quot;可以读取 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                string something=<span class="string">&quot;文件&quot;</span>+name+<span class="string">&quot;读取出现异常,不存在的路径 :(&quot;</span>;</span><br><span class="line">                <span class="keyword">throw</span> something;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ~<span class="built_in">IFileStream</span>()&#123;</span><br><span class="line">        FilePath=<span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">if</span>(ifile.<span class="built_in">is_open</span>())&#123;</span><br><span class="line">            ifile.<span class="built_in">close</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function">ifstream&amp; <span class="title">getifsteram</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> ifile;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">class</span> <span class="title class_">FileFormatter</span>&#123;</span><br><span class="line">    <span class="keyword">private</span>:</span><br><span class="line">    OFileStream ost;</span><br><span class="line">    IFileStream ist;</span><br><span class="line">    vector&lt;string&gt; vecbuf;</span><br><span class="line">    vector&lt;string&gt; newbuf;</span><br><span class="line">    <span class="type">unsigned</span> num;</span><br><span class="line">    <span class="keyword">public</span>:</span><br><span class="line">    <span class="built_in">FileFormatter</span>(<span class="type">const</span> string FilePath,<span class="type">const</span> string newFilePath,<span class="type">unsigned</span> n):<span class="built_in">ist</span>(FilePath),<span class="built_in">ost</span>(newFilePath),<span class="built_in">num</span>(n),<span class="built_in">vecbuf</span>(),<span class="built_in">newbuf</span>()&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">readFromFile</span><span class="params">()</span><span class="comment">//读取源文件</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//ist是读取文件的留，我们利用它把文件读取到指定的容器vector中。</span></span><br><span class="line">    <span class="comment">//然后再对其进行格式化。所以此函数的作用就是将ist的内容读取出来放到vector中。</span></span><br><span class="line">        <span class="comment">//如果文件不存在，初始化的时候会报错</span></span><br><span class="line">        <span class="comment">//该函数作用域结束后会调用析构函数，不会造成资源浪费。</span></span><br><span class="line">        stringstream ss;</span><br><span class="line">        string temp,t;</span><br><span class="line">        <span class="type">char</span> c[num+<span class="number">10</span>];</span><br><span class="line">        <span class="keyword">while</span> (<span class="built_in">getline</span>(ist.<span class="built_in">getifsteram</span>(),temp))&#123;</span><br><span class="line">           <span class="comment">//temp=c;</span></span><br><span class="line">           ss&lt;&lt;temp;</span><br><span class="line">           <span class="keyword">while</span>(ss &gt;&gt; t)&#123;</span><br><span class="line">                vecbuf.<span class="built_in">push_back</span>(t);<span class="comment">//把每个单词放在容器里。</span></span><br><span class="line">           &#125;</span><br><span class="line">           ss.<span class="built_in">clear</span>();<span class="comment">//提取完一行清除字符串流</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">formatText</span><span class="params">()</span><span class="comment">//格式化字符句子</span></span></span><br><span class="line"><span class="function">    </span>&#123;<span class="comment">//如果单词字符数大于n，则单独独占一行</span></span><br><span class="line">        <span class="comment">//外层循环的结束条件是vector是否用完</span></span><br><span class="line">        <span class="keyword">while</span>(vecbuf.<span class="built_in">size</span>())&#123;</span><br><span class="line">            string str=<span class="string">&quot;&quot;</span>;</span><br><span class="line">            <span class="keyword">if</span>(vecbuf.<span class="built_in">front</span>().<span class="built_in">length</span>()&gt;=num)&#123;</span><br><span class="line">                newbuf.<span class="built_in">push_back</span>(vecbuf.<span class="built_in">front</span>());</span><br><span class="line">                vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());<span class="comment">//删除第一个元素</span></span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">while</span>(str.<span class="built_in">length</span>()&lt;num)&#123;<span class="comment">//对于一个句子，当前句子长度+单词长度大于num就不执行了</span></span><br><span class="line">                <span class="type">bool</span> flag=vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;.&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;!&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;\&quot;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;,&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;:&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;?&quot;</span>;</span><br><span class="line">                    <span class="keyword">if</span>(str.<span class="built_in">length</span>()==<span class="number">0</span>)&#123; </span><br><span class="line">                        <span class="comment">//检测巨首是不是标点</span></span><br><span class="line">                        <span class="keyword">if</span>(flag)&#123;<span class="comment">//如果是标点符号，进行处理。</span></span><br><span class="line">                            cerr&lt;&lt;<span class="string">&quot;句首出现标点符号&quot;</span>&lt;&lt;endl;</span><br><span class="line">                        &#125;</span><br><span class="line">                        <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                            str=vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                            vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="comment">//如果小于，就继续做</span></span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>((str.<span class="built_in">length</span>()+vecbuf.<span class="built_in">front</span>().<span class="built_in">length</span>()+<span class="number">1</span>)&lt;=num&amp;&amp;!flag)&#123;<span class="comment">//句子加单词长度大于num，而不是加符号</span></span><br><span class="line">                        <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                            str=str+<span class="string">&quot; &quot;</span>+vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                            vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span> <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">                        <span class="keyword">while</span>(flag)&#123;</span><br><span class="line">                            <span class="keyword">if</span>(!vecbuf.<span class="built_in">empty</span>())&#123;<span class="comment">//如果句尾是标点连着的话，就连续处理</span></span><br><span class="line">                                str=str+<span class="string">&quot; &quot;</span>+vecbuf.<span class="built_in">front</span>();</span><br><span class="line">                                vecbuf.<span class="built_in">erase</span>(vecbuf.<span class="built_in">begin</span>());</span><br><span class="line">                                flag=vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;.&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;!&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;\&quot;&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;,&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;:&quot;</span>||vecbuf.<span class="built_in">front</span>()==<span class="string">&quot;?&quot;</span>;</span><br><span class="line">                            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                                flag=<span class="literal">false</span>;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                        flag=<span class="literal">false</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">if</span>(vecbuf.<span class="built_in">empty</span>())&#123;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">                newbuf.<span class="built_in">push_back</span>(str);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="type">void</span> <span class="title">saveToFile</span><span class="params">()</span><span class="comment">//将格式化后的文本内容保存到新的位置和文件名。</span></span></span><br><span class="line"><span class="function">    </span>&#123;   </span><br><span class="line">        ofstream&amp; outfile=ost.<span class="built_in">getofsteram</span>();</span><br><span class="line">        <span class="keyword">for</span>(<span class="type">const</span> string &amp;s:newbuf)&#123;</span><br><span class="line">            outfile&lt;&lt;s&lt;&lt;endl;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">shared_ptr&lt;IFileStream&gt; ifs;</span><br><span class="line">shared_ptr&lt;FileFormatter&gt; ff;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">BlankFliter</span><span class="params">(string &amp;str)</span><span class="comment">//使用C++string类的方法快速删除空格</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">//std::remove_if函数用于将所有空白字符移动到字符串的末尾，</span></span><br><span class="line">    <span class="comment">//然后使用erase函数将它们从字符串中删除。</span></span><br><span class="line">    <span class="comment">//::isspace函数是一个标准库函数，用于检查一个字符是否为空白字符。</span></span><br><span class="line">    str.<span class="built_in">erase</span>(std::<span class="built_in">remove_if</span>(str.<span class="built_in">begin</span>(), str.<span class="built_in">end</span>(), ::isspace), str.<span class="built_in">end</span>()); </span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ExpTraslate</span><span class="params">(string &amp;buf)</span></span>;</span><br><span class="line"><span class="function">string <span class="title">IsNameReturn</span><span class="params">(string &amp;buf)</span></span>&#123;<span class="comment">//针对一个单词的一次性检查</span></span><br><span class="line">    string result;</span><br><span class="line">    <span class="keyword">auto</span> iter = umap.<span class="built_in">find</span>(buf);</span><br><span class="line">    <span class="keyword">if</span>(iter!=umap.<span class="built_in">end</span>())&#123;</span><br><span class="line">        result=iter-&gt;second;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> buf;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">StringTraslate</span><span class="params">(string &amp;buf)</span><span class="comment">//处理用户输入的字符串</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//首先判断是否执行 查询操作</span></span><br><span class="line">    <span class="keyword">if</span>(buf[<span class="number">0</span>]==<span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">        buf.<span class="built_in">erase</span>(buf.<span class="built_in">begin</span>());</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">//然后判断是否执行 赋值 操作</span></span><br><span class="line">    <span class="type">int</span> temp=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> times=<span class="number">0</span>;</span><br><span class="line">    string name,value;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;buf.<span class="built_in">size</span>()<span class="number">-1</span>;i++)&#123;</span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;&gt;&#x27;</span>&amp;&amp;buf[i+<span class="number">1</span>]==<span class="string">&#x27;&gt;&#x27;</span>)&#123;  </span><br><span class="line">            filename=buf.<span class="built_in">substr</span>(i+<span class="number">2</span>,buf.<span class="built_in">size</span>()-i<span class="number">-2</span>);</span><br><span class="line">            buf=buf.<span class="built_in">substr</span>(<span class="number">0</span>,i);<span class="comment">//前面是查询的单词</span></span><br><span class="line">            filesearch=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1</span>;i&lt;buf.<span class="built_in">length</span>();i++)&#123;<span class="comment">//跳过第一个字符，检查是否有赋值操作</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;=&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">for</span>(<span class="type">int</span> j=i;j&lt;buf.<span class="built_in">length</span>();j++)&#123;</span><br><span class="line">                <span class="keyword">if</span>(buf[j]==<span class="string">&#x27;\&quot;&#x27;</span>&amp;&amp;times==<span class="number">0</span>)&#123;<span class="comment">//找到&quot;说明是常量</span></span><br><span class="line">                    temp=j+<span class="number">1</span>;</span><br><span class="line">                    times++;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span>(buf[j]==<span class="string">&#x27;\&quot;&#x27;</span>&amp;&amp;times==<span class="number">1</span>)&#123;</span><br><span class="line">                    value=buf.<span class="built_in">substr</span>(temp,j-temp);</span><br><span class="line">                    times++;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(j==buf.<span class="built_in">length</span>()<span class="number">-1</span>)&#123;<span class="comment">//找到最后一位的时候，说明这可能是个变量</span></span><br><span class="line">                    string qwq=buf.<span class="built_in">substr</span>(temp,j-temp);</span><br><span class="line">                    <span class="keyword">auto</span> iter = umap.<span class="built_in">find</span>(qwq);</span><br><span class="line">                    <span class="keyword">if</span>(iter!=umap.<span class="built_in">end</span>())&#123;</span><br><span class="line">                        value=iter-&gt;second;</span><br><span class="line">                        <span class="keyword">break</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                    <span class="keyword">else</span>&#123;</span><br><span class="line">                        cerr&lt;&lt;<span class="string">&quot;输入了一个不存在的变量，如果需要输入常量abcd，请用\&quot;abcd\&quot;包裹常量abcd :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span>(times%<span class="number">2</span>)&#123;</span><br><span class="line">                cerr&lt;&lt;<span class="string">&quot;请确保\&quot;abcd\&quot;包裹常量abcd :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">            &#125;</span><br><span class="line">            name=buf.<span class="built_in">substr</span>(<span class="number">0</span>,i);</span><br><span class="line">            umap[name]=value;</span><br><span class="line">            <span class="keyword">return</span> ;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//执行表达式处理操作 操作分为分割和计算</span></span><br><span class="line">    <span class="built_in">ExpTraslate</span>(buf);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">bool</span> <span class="title">isOperater</span><span class="params">(string str)</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(str==<span class="string">&quot;|&quot;</span>||str==<span class="string">&quot;&amp;&quot;</span>||str==<span class="string">&quot;~&quot;</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">Precedence</span><span class="params">(<span class="type">char</span> op)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;~&#x27;</span>) <span class="keyword">return</span> <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;&amp;&#x27;</span>) <span class="keyword">return</span> <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (op == <span class="string">&#x27;|&#x27;</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">ExpTraslate</span><span class="params">(string &amp;buf)</span></span>&#123;<span class="comment">//可能出现错误，可以尝试异常处理</span></span><br><span class="line">    stack&lt;shared_ptr&lt;Query&gt;&gt; qstack;</span><br><span class="line">    stack&lt;<span class="type">char</span>&gt; opstack;</span><br><span class="line">    <span class="type">char</span> op;</span><br><span class="line">    vector&lt;string&gt; backexp;</span><br><span class="line">    <span class="type">int</span> word_start=<span class="number">0</span>;</span><br><span class="line">    <span class="type">bool</span> last_right=buf[buf.<span class="built_in">size</span>()<span class="number">-1</span>]==<span class="string">&#x27;)&#x27;</span>;<span class="comment">//看在最后一个是不是右边括号</span></span><br><span class="line">    <span class="type">bool</span> Had_op=<span class="number">0</span>;</span><br><span class="line">    <span class="type">int</span> priority1;</span><br><span class="line">    <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">0</span>;i&lt;buf.<span class="built_in">size</span>();i++)&#123;<span class="comment">//分割字符串并转成后缀表达式</span></span><br><span class="line">        <span class="keyword">if</span>(buf[i]==<span class="string">&#x27;~&#x27;</span>||buf[i]==<span class="string">&#x27;|&#x27;</span>||buf[i]==<span class="string">&#x27;&amp;&#x27;</span>||buf[i]==<span class="string">&#x27;(&#x27;</span>||buf[i]==<span class="string">&#x27;)&#x27;</span>)&#123;</span><br><span class="line">            Had_op=<span class="number">1</span>;</span><br><span class="line">            op=buf[i];</span><br><span class="line">            priority1=<span class="built_in">Precedence</span>(op);</span><br><span class="line">            <span class="keyword">if</span> (opstack.<span class="built_in">empty</span>()||op==<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">//或者左括号直接压栈</span></span><br><span class="line">                opstack.<span class="built_in">push</span>(op);</span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(op ==<span class="string">&#x27;)&#x27;</span>)&#123;<span class="comment">//如果当前位置是右括号</span></span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;<span class="comment">//排除()遇到)的情况</span></span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span>(!opstack.<span class="built_in">empty</span>()&amp;&amp;opstack.<span class="built_in">top</span>()!=<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">// 不断将栈中的元素弹出，直到遇到左括号</span></span><br><span class="line">                    <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span>(!opstack.<span class="built_in">empty</span>()&amp;&amp;opstack.<span class="built_in">top</span>()==<span class="string">&#x27;(&#x27;</span>)&#123;<span class="comment">//遇到左括号就将他弹出</span></span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">else</span>&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式括号不匹配，请检查并重启程序 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span>(op==<span class="string">&#x27;~&#x27;</span>||op==<span class="string">&#x27;|&#x27;</span>||op==<span class="string">&#x27;&amp;&#x27;</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">if</span>(i-word_start&gt;<span class="number">0</span>)&#123;<span class="comment">//排除(~a)遇到~的情况</span></span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,i-word_start));</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">while</span>((!opstack.<span class="built_in">empty</span>())&amp;&amp;(<span class="built_in">Precedence</span>(opstack.<span class="built_in">top</span>())&gt;=priority1))&#123;</span><br><span class="line">                    <span class="comment">// 如果栈不空，栈顶为运算符，并且栈顶运算符的优先级大于等于当前运算符的优先级</span></span><br><span class="line">                    <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">                    opstack.<span class="built_in">pop</span>();</span><br><span class="line">                    backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//再将操作符压入栈</span></span><br><span class="line">                opstack.<span class="built_in">push</span>(op);</span><br><span class="line">                word_start=i+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;<span class="comment">//清空栈，放到后缀表达式</span></span><br><span class="line">    <span class="keyword">if</span>(!last_right)&#123;</span><br><span class="line">        backexp.<span class="built_in">push_back</span>(buf.<span class="built_in">substr</span>(word_start,buf.<span class="built_in">size</span>()-word_start));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(!opstack.<span class="built_in">empty</span>())&#123;<span class="comment">//如果op栈不空，弹出所有元素到后缀表达式</span></span><br><span class="line">        <span class="function">string <span class="title">tempop</span><span class="params">(<span class="number">1</span>,opstack.top())</span></span>;</span><br><span class="line">        opstack.<span class="built_in">pop</span>();</span><br><span class="line">        backexp.<span class="built_in">push_back</span>(tempop);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!Had_op)&#123;<span class="comment">//没有运算符，直接走捷径</span></span><br><span class="line">        <span class="function">Query <span class="title">onetime</span><span class="params">(IsNameReturn(buf))</span></span>;</span><br><span class="line">        <span class="keyword">if</span>(filesearch)&#123;</span><br><span class="line">            <span class="function">OFileStream <span class="title">ofi</span><span class="params">(filename)</span></span>;</span><br><span class="line">            cout&lt;&lt;onetime.<span class="built_in">rep</span>()&lt;&lt;endl;</span><br><span class="line">            </span><br><span class="line">            onetime.<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">write</span>(ofi.<span class="built_in">getofsteram</span>());</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;写入成功&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            cout&lt;&lt;onetime.<span class="built_in">rep</span>()&lt;&lt;endl;</span><br><span class="line">            onetime.<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">print</span>();</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果有运算符，都在栈里面</span></span><br><span class="line">    <span class="keyword">while</span>(!backexp.<span class="built_in">empty</span>())&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">isOperater</span>(backexp.<span class="built_in">front</span>()))<span class="comment">//判断向量backexp里面的是不是运算符</span></span><br><span class="line">        &#123;</span><br><span class="line">            string opstr=backexp.<span class="built_in">front</span>();</span><br><span class="line">            <span class="keyword">if</span>(opstr==<span class="string">&quot;|&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="keyword">return</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp1=qstack.<span class="built_in">top</span>();</span><br><span class="line">                <span class="comment">//temp1=qstack.top();</span></span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; temp2=qstack.<span class="built_in">top</span>(); </span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(*temp1.<span class="built_in">get</span>()|*temp2.<span class="built_in">get</span>());</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opstr==<span class="string">&quot;&amp;&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">2</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                    <span class="keyword">return</span> ;  </span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp1=qstack.<span class="built_in">top</span>();</span><br><span class="line">                <span class="comment">//temp1=qstack.top();</span></span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; temp2=qstack.<span class="built_in">top</span>();</span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(*temp1.<span class="built_in">get</span>()&amp;*temp2.<span class="built_in">get</span>());</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span>(opstr==<span class="string">&quot;~&quot;</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()&lt;<span class="number">1</span>)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;表达式所需要的操作数不够... :(&quot;</span>&lt;&lt;endl ; </span><br><span class="line">                    <span class="keyword">return</span> ;</span><br><span class="line">                &#125;</span><br><span class="line">                shared_ptr&lt;Query&gt; temp=qstack.<span class="built_in">top</span>();</span><br><span class="line">                qstack.<span class="built_in">pop</span>();</span><br><span class="line">                shared_ptr&lt;Query&gt; result=<span class="built_in">make_shared</span>&lt;Query&gt;(~(*temp.<span class="built_in">get</span>()));</span><br><span class="line">                qstack.<span class="built_in">push</span>(result);</span><br><span class="line">            &#125;</span><br><span class="line">            backexp.<span class="built_in">erase</span>(backexp.<span class="built_in">begin</span>());</span><br><span class="line">        &#125;<span class="comment">//如果不是则执行下面，将Query对象入栈</span></span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            qstack.<span class="built_in">push</span>(<span class="built_in">make_shared</span>&lt;Query&gt;(<span class="built_in">IsNameReturn</span>(backexp.<span class="built_in">front</span>())));<span class="comment">//栈里面的都是共享指针</span></span><br><span class="line">            backexp.<span class="built_in">erase</span>(backexp.<span class="built_in">begin</span>());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//最后所有运算操作完成</span></span><br><span class="line">    <span class="keyword">if</span>(qstack.<span class="built_in">size</span>()==<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="keyword">if</span>(filesearch)&#123;</span><br><span class="line">            <span class="function">OFileStream <span class="title">ofi</span><span class="params">(filename)</span></span>;</span><br><span class="line">            qstack.<span class="built_in">top</span>()-&gt;<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">write</span>(ofi.<span class="built_in">getofsteram</span>());</span><br><span class="line">            cout&lt;&lt;<span class="string">&quot;写入成功&quot;</span>&lt;&lt;endl;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            qstack.<span class="built_in">top</span>()-&gt;<span class="built_in">eval</span>(<span class="built_in">TextQuery</span>(ifs-&gt;<span class="built_in">getifsteram</span>())).<span class="built_in">print</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        cerr&lt;&lt;<span class="string">&quot;表达式可能出现错误，无法运算出唯一结果&quot;</span>&lt;&lt;endl;</span><br><span class="line">        <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="type">void</span> <span class="title">menu</span><span class="params">()</span></span>&#123;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;选择需要的功能：&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;1.文本格式化&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;2.文本查询&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;3.退出&quot;</span>&lt;&lt;endl;</span><br><span class="line">    cout&lt;&lt;<span class="string">&quot;Your Choice: &quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="type">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;<span class="comment">//对输入的buf进行判别</span></span><br><span class="line">    <span class="type">int</span> cho;</span><br><span class="line">    string buf;</span><br><span class="line"></span><br><span class="line">    string newbuf;</span><br><span class="line">    <span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">        <span class="built_in">menu</span>();</span><br><span class="line">        cin&gt;&gt;cho;</span><br><span class="line">        cin.<span class="built_in">ignore</span>();</span><br><span class="line">        <span class="keyword">switch</span> (cho)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">1</span>:<span class="comment">//让用户输入路径</span></span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请输入读取的文件路径&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,buf);</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请指定每行最大的字符数n :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt;&quot;</span>;</span><br><span class="line">                <span class="type">int</span> num;</span><br><span class="line">                cin&gt;&gt;num;</span><br><span class="line">                cin.<span class="built_in">ignore</span>();</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请指定新文件保存的路径 :)&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt;&quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,newbuf);</span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    ff=<span class="built_in">make_shared</span>&lt;FileFormatter&gt;(buf,newbuf,num);</span><br><span class="line">                    ff-&gt;<span class="built_in">readFromFile</span>();</span><br><span class="line">                    ff-&gt;formatText();</span><br><span class="line">                    ff-&gt;<span class="built_in">saveToFile</span>();</span><br><span class="line">                &#125;<span class="built_in">catch</span>(string str)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;错误的文件路径&quot;</span>&lt;&lt;buf&lt;&lt;<span class="string">&quot;导致打开异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;<span class="built_in">catch</span>(<span class="type">char</span> ch)&#123;</span><br><span class="line">                    cerr&lt;&lt;<span class="string">&quot;错误的文件路径&quot;</span>&lt;&lt;buf&lt;&lt;<span class="string">&quot;导致写入异常 :(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">2</span>:</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;请输入读取的文件路径&quot;</span>&lt;&lt;endl;</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                <span class="built_in">getline</span>(cin,newbuf);<span class="comment">//buf就是路径</span></span><br><span class="line">                <span class="keyword">try</span>&#123;</span><br><span class="line">                    ifs=<span class="built_in">make_shared</span>&lt;IFileStream&gt;(newbuf);</span><br><span class="line">                    cout&lt;&lt;<span class="string">&quot;&gt;&gt;&gt; &quot;</span>;</span><br><span class="line">                    <span class="built_in">getline</span>(cin,buf);<span class="comment">//从输入流中读取一行数据到buf</span></span><br><span class="line">                    <span class="built_in">BlankFliter</span>(buf);<span class="comment">//首先排除空格的影响</span></span><br><span class="line">                    <span class="built_in">StringTraslate</span>(buf);</span><br><span class="line">                &#125;<span class="built_in">catch</span>(string str)&#123;</span><br><span class="line">                    cerr&lt;&lt;str;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">case</span> <span class="number">3</span>:</span><br><span class="line">                <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                cout&lt;&lt;<span class="string">&quot;无效的选项:(&quot;</span>&lt;&lt;endl;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>










    </div>

    
    
    
        

<div>
<ul class="post-copyright">
  <li class="post-copyright-author">
    <strong>本文作者： </strong>xswlhhh
  </li>
  <li class="post-copyright-link">
    <strong>本文链接：</strong>
    <a href="http://example.com/2024/11/08/C-%E7%AC%AC%E4%B8%89%E6%AC%A1%E5%B0%8F%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E6%96%87%E6%9C%AC%E6%9F%A5%E8%AF%A2%E7%A8%8B%E5%BA%8F/" title="C++第三次小项目——文本查询程序">http://example.com/2024/11/08/C-第三次小项目——文本查询程序/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>

	
      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/C/" rel="tag"># C++</a>
              <a href="/tags/%E4%BD%9C%E4%B8%9A/" rel="tag"># 作业</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/2024/11/08/C-%E7%AC%AC%E4%BA%8C%E6%AC%A1%E5%B0%8F%E9%A1%B9%E7%9B%AE%E2%80%94%E2%80%94%E5%9B%9B%E5%88%99%E9%A2%84%E7%AE%97%E5%99%A8/" rel="prev" title="C++第二次小项目——四则预算器">
      <i class="fa fa-chevron-left"></i> C++第二次小项目——四则预算器
    </a></div>
      <div class="post-nav-item"></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          
    
  <div class="comments">
    <div id="lv-container" data-id="city" data-uid="MTAyMC81OTY4MS8zNjE0Mw=="></div>
  </div>
  

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">
	<!--网易云插件-->
	<iframe frameborder="no" border="0" marginwidth="0" marginheight="0" width=330 height=86 src="//music.163.com/outchain/player?type=2&id=489847882&auto=1&height=66"></iframe>

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#ye4Hl"><span class="nav-number">1.</span> <span class="nav-text">实验报告解析</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#Pz6p1"><span class="nav-number">1.1.</span> <span class="nav-text">写在前面</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Kyyb2"><span class="nav-number">1.2.</span> <span class="nav-text">开始解析</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#iBy3I"><span class="nav-number">1.2.1.</span> <span class="nav-text">基于面向对象的所用类介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#R3Ror"><span class="nav-number">1.2.1.1.</span> <span class="nav-text">对于TextQuery</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#RQI0Z"><span class="nav-number">1.2.1.2.</span> <span class="nav-text">对于QueryResult</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#eyY5A"><span class="nav-number">1.2.1.3.</span> <span class="nav-text">关于采用逻辑查询操作的类</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#sBBTg"><span class="nav-number">1.2.1.4.</span> <span class="nav-text">关于文件资源管理的类(RAII的思想体现）</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#WTL9t"><span class="nav-number">1.2.2.</span> <span class="nav-text">解析需求3,4,5</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#LFdEA"><span class="nav-number">1.2.3.</span> <span class="nav-text">解析需求6</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#nUiFV"><span class="nav-number">1.2.4.</span> <span class="nav-text">解析需求7</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#wWtmc"><span class="nav-number">1.2.5.</span> <span class="nav-text">解析需求9</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Hn8Uf"><span class="nav-number">1.2.6.</span> <span class="nav-text">解析需求11</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#p9gkH"><span class="nav-number">2.</span> <span class="nav-text">总结</span></a></li><li class="nav-item nav-level-1"><a class="nav-link" href="#%E6%BA%90%E4%BB%A3%E7%A0%81"><span class="nav-number">3.</span> <span class="nav-text">源代码</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="xswlhhh"
      src="/images/myavatar.jpg">
  <p class="site-author-name" itemprop="name">xswlhhh</p>
  <div class="site-description" itemprop="description">用最少的时间做无关的事，用最多的时间做紧要的事</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">10</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">5</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">14</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="/2991796382@qq.com" title="E-Mail → 2991796382@qq.com"><i class="fa fa-envelope fa-fw"></i>E-Mail</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 2024-03 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">xswlhhh</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-area"></i>
    </span>
    <span title="站点总字数">171k</span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">2:36</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>



    <script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    <span id="busuanzi_container_site_pv">总访问量<span id="busuanzi_value_site_pv"></span>次</span>
    <span class="post-meta-divider">|</span>
    <span id="busuanzi_container_site_uv">总访客数<span id="busuanzi_value_site_uv"></span>人</span>
    <span class="post-meta-divider">|</span>
<!-- 不蒜子计数初始值纠正 -->
<script>
$(document).ready(function() {

    var int = setInterval(fixCount, 50);  // 50ms周期检测函数
    var countOffset = 20000;  // 初始化首次数据

    function fixCount() {            
       if (document.getElementById("busuanzi_container_site_pv").style.display != "none")
        {
            $("#busuanzi_value_site_pv").html(parseInt($("#busuanzi_value_site_pv").html()) + countOffset); 
            clearInterval(int);
        }                  
        if ($("#busuanzi_container_site_pv").css("display") != "none")
        {
            $("#busuanzi_value_site_uv").html(parseInt($("#busuanzi_value_site_uv").html()) + countOffset); // 加上初始数据 
            clearInterval(int); // 停止检测
        }  
    }
       	
});
</script> 

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

<script>
NexT.utils.loadComments(document.querySelector('#lv-container'), () => {
  window.livereOptions = {
    refer: location.pathname.replace(CONFIG.root, '').replace('index.html', '')
  };
  (function(d, s) {
    var j, e = d.getElementsByTagName(s)[0];
    if (typeof LivereTower === 'function') { return; }
    j = d.createElement(s);
    j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
    j.async = true;
    e.parentNode.insertBefore(j, e);
  })(document, 'script');
});
</script>

</body>
</html>
